---
import "../styles/global.css";
import { profile } from "../data/profile";

type JsonLd = Record<string, unknown>;

interface Props {
  title?: string;
  description?: string;
  path?: string;
  image?: string;
  noindex?: boolean;
  jsonLd?: JsonLd | JsonLd[];
}

const {
  title = `${profile.name} | ${profile.roleTitle}`,
  description = profile.summary,
  path = Astro.url.pathname,
  image = "/favicon.svg",
  noindex = false,
  jsonLd,
} = Astro.props;

const canonical = new URL(path, profile.siteUrl).toString();
const ogImage = image.startsWith("http") ? image : new URL(image, profile.siteUrl).toString();

const navItems = [
  { href: "/", label: "Home" },
  { href: "/work", label: "Work" },
  { href: "/about", label: "About" },
  { href: "/resume", label: "Resume" },
  { href: "/contact", label: "Contact" },
];

const isActive = (href: string) =>
  href === "/"
    ? Astro.url.pathname === "/"
    : Astro.url.pathname === href || Astro.url.pathname.startsWith(`${href}/`);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="robots" content={noindex ? "noindex,nofollow" : "index,follow"} />
    <link rel="canonical" href={canonical} />

    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonical} />
    <meta property="og:image" content={ogImage} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    {jsonLd && <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />}
  </head>
  <body class="antialiased">

    <!-- Noise overlay -->
    <div class="noise-overlay" aria-hidden="true"></div>

    <!-- Cursor -->
    <div id="cursor-dot" aria-hidden="true"></div>
    <div id="cursor-ring" aria-hidden="true"></div>

    <!-- NAV -->
    <header class="fixed inset-x-0 top-0 z-50" style="backdrop-filter: blur(28px); -webkit-backdrop-filter: blur(28px); background: rgba(7,9,15,0.55); border-bottom: 1px solid rgba(255,255,255,0.07);">

      <!-- Top micro-bar: location left · logo center · status right -->
      <div class="mx-auto max-w-7xl px-6 flex items-center justify-between h-10 border-b" style="border-color: rgba(255,255,255,0.05);">
        <span class="text-xs font-mono tracking-widest text-slate-600 uppercase hidden sm:block">
          {profile.location} &nbsp;·&nbsp; Available for mandates
        </span>
        <a href="/" class="absolute left-1/2 -translate-x-1/2 flex items-center gap-2.5">
          <div class="relative w-6 h-6 shrink-0">
            <img
              src="/profile.jpg"
              alt={profile.name}
              width="24"
              height="24"
              class="w-6 h-6 rounded-full object-cover object-top"
              style="border: 1px solid rgba(147,197,253,0.35);"
            />
          </div>
          <span class="text-xs font-mono tracking-[0.25em] uppercase text-slate-300">
            {profile.name}
          </span>
        </a>
        <div class="flex items-center gap-1.5">
          <div class="w-1.5 h-1.5 rounded-full bg-green-400" style="box-shadow: 0 0 6px rgba(74,222,128,0.7);"></div>
          <span class="text-xs font-mono tracking-widest text-slate-500 uppercase hidden sm:block">Open to work</span>
        </div>
      </div>

      <!-- Main nav bar -->
      <div class="mx-auto max-w-7xl px-6 flex items-center justify-between h-12">

        <!-- Left: photo + name (desktop) -->
        <a href="/" class="flex items-center gap-2.5 group">
          <div class="relative w-7 h-7 shrink-0">
            <div class="absolute inset-0 rounded-full"
              style="border: 1px solid rgba(147,197,253,0.30); transform: scale(1.25); animation: pulse 3s ease-in-out infinite;">
            </div>
            <img
              src="/profile.jpg"
              alt={profile.name}
              width="28"
              height="28"
              class="w-7 h-7 rounded-full object-cover object-top relative z-10"
              style="border: 1.5px solid rgba(147,197,253,0.40); box-shadow: 0 0 10px rgba(37,99,235,0.4);"
            />
          </div>
          <span class="text-xs font-semibold tracking-wider text-slate-400 group-hover:text-white transition hidden lg:block">
            MV
          </span>
        </a>

        <!-- Center: nav links -->
        <nav class="flex items-center gap-1 text-xs">
          {navItems.map((item) => (
            <a
              href={item.href}
              class={`rounded-full px-3.5 py-1.5 font-medium tracking-wide transition-all duration-200 ${
                isActive(item.href)
                  ? "text-white"
                  : "text-slate-500 hover:text-slate-200"
              }`}
              style={isActive(item.href) ? "background: rgba(255,255,255,0.08);" : ""}
            >
              {item.label}
            </a>
          ))}
        </nav>

        <!-- Right: WhatsApp CTA -->
        <a
          href={profile.links.whatsapp}
          target="_blank"
          rel="noreferrer"
          class="hidden sm:inline-flex items-center gap-1.5 rounded-full px-4 py-1.5 text-xs font-medium font-mono tracking-wider transition-all duration-200 hover:scale-[1.03]"
          style="background: rgba(37,99,235,0.20); border: 1px solid rgba(37,99,235,0.40); color: #93c5fd;"
        >
          <span style="color: #93c5fd;">↗</span> WhatsApp
        </a>
      </div>

    </header>

    <!-- MAIN -->
    <main class="flex-1 pt-[88px] container-shell">
      <slot />
    </main>

    <!-- FOOTER -->
    <footer class="mt-16 px-4 pb-10">
      <div class="mx-auto max-w-6xl glass-panel rounded-3xl px-8 py-8">
        <div class="grid gap-8 md:grid-cols-3 md:items-start">

          <!-- Identity -->
          <div class="space-y-3">
            <p class="font-display text-base font-semibold text-white">{profile.name}</p>
            <p class="text-sm text-accent-soft">{profile.roleTitle}</p>
            <p class="text-xs text-slate-500">{profile.location}</p>
          </div>

          <!-- Links -->
          <div class="space-y-2">
            <p class="text-xs uppercase tracking-widest text-slate-600 mb-3">Connect</p>
            <a href={profile.links.whatsapp} target="_blank" rel="noreferrer"
              class="flex items-center gap-2 text-sm text-slate-400 hover:text-accent-soft transition-colors">
              <span class="text-xs text-accent-soft">↗</span> WhatsApp · {profile.whatsappDisplay}
            </a>
            <a href={profile.links.email}
              class="flex items-center gap-2 text-sm text-slate-400 hover:text-accent-soft transition-colors">
              <span class="text-xs text-accent-soft">✉</span> {profile.email}
            </a>
            <a href={profile.links.instagram} target="_blank" rel="noreferrer"
              class="flex items-center gap-2 text-sm text-slate-400 hover:text-accent-soft transition-colors">
              <span class="text-xs text-accent-soft">◎</span> {profile.links.instagramHandle}
            </a>
          </div>

          <!-- Nav -->
          <div class="space-y-2">
            <p class="text-xs uppercase tracking-widest text-slate-600 mb-3">Navigate</p>
            {navItems.map((item) => (
              <a href={item.href}
                class="block text-sm text-slate-400 hover:text-white transition-colors">
                {item.label}
              </a>
            ))}
          </div>
        </div>

        <div class="mt-8 pt-6 border-t border-white/6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
          <p class="text-xs text-slate-600">© {new Date().getFullYear()} {profile.name} — All rights reserved.</p>
          <p class="text-xs text-slate-700 font-mono">Dubai, UAE · Available for new mandates</p>
        </div>
      </div>
    </footer>

    <!-- Cursor JS -->
    <script is:inline>
      (() => {
        const dot = document.getElementById("cursor-dot");
        const ring = document.getElementById("cursor-ring");
        if (!dot || !ring) return;

        let mx = -100, my = -100, rx = -100, ry = -100;
        let rafId;

        document.addEventListener("mousemove", (e) => {
          mx = e.clientX; my = e.clientY;
          dot.style.left = mx + "px";
          dot.style.top = my + "px";
        });

        const animateRing = () => {
          rx += (mx - rx) * 0.12;
          ry += (my - ry) * 0.12;
          ring.style.left = rx + "px";
          ring.style.top = ry + "px";
          rafId = requestAnimationFrame(animateRing);
        };
        animateRing();

        document.querySelectorAll("a, button, [role=button], input, textarea, select").forEach((el) => {
          el.addEventListener("mouseenter", () => document.body.classList.add("cursor-hover"));
          el.addEventListener("mouseleave", () => document.body.classList.remove("cursor-hover"));
        });

        document.addEventListener("mousedown", () => document.body.classList.add("cursor-clicking"));
        document.addEventListener("mouseup", () => document.body.classList.remove("cursor-clicking"));
        document.addEventListener("mouseleave", () => { dot.style.opacity = "0"; ring.style.opacity = "0"; });
        document.addEventListener("mouseenter", () => { dot.style.opacity = "1"; ring.style.opacity = "1"; });
      })();
    </script>

    <!-- Reveal observer -->
    <script is:inline>
      (() => {
        const els = document.querySelectorAll(".reveal");
        if (!els.length) return;
        const obs = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const el = entry.target;
              const delay = el.getAttribute("data-delay") || "0";
              setTimeout(() => el.classList.add("visible"), parseFloat(delay) * 1000);
              obs.unobserve(el);
            }
          });
        }, { threshold: 0.12 });
        els.forEach((el) => obs.observe(el));
      })();
    </script>

  </body>
</html>
