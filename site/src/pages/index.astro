---
import BaseLayout from "../layouts/BaseLayout.astro";
import AnimatedCounter from "../components/motion/AnimatedCounter";
import CapabilityIcon from "../components/CapabilityIcon";
import {
  ArrowUpRight,
  ArrowRight,
  MessageCircle,
  Zap,
  ChevronDown,
  ExternalLink,
  Plus,
  Check,
  Star,
  Building2,
} from "lucide-react";
import { profile } from "../data/profile";
import { projects } from "../data/projects";
import { testimonials } from "../data/testimonials";

const featuredProjects = projects.filter((p) => p.featured).slice(0, 3);
const capabilityIconNames = ["growth", "analytics", "web", "content", "ops", "dev"] as const;
const capabilityMedia = {
  0: { src: "/capabilities/cap-growth.webm", poster: "/capabilities/cap-growth.jpg", position: "top" },
  2: { src: "/capabilities/cap-web.webm", poster: "/capabilities/cap-web.jpg", position: "top" },
  4: { src: "/capabilities/cap-ops.webm", poster: "/capabilities/cap-ops.jpg", position: "bottom" },
} as const;

const tickerRow1 = [
  "Meta Ads",
  "Google Ads",
  "Funnel Architecture",
  "Creative Strategy",
  "Pixel Tracking",
  "UTM Governance",
  "Lead Generation",
  "SEO",
  "WhatsApp Funnels",
  "A/B Testing",
  "Conversion Rate Optimization",
  "Lead Quality Scoring",
  "Performance Marketing",
  "Dubai UAE",
];

const tickerRow2 = [
  "ChatGPT",
  "Claude AI",
  "Midjourney",
  "AI Copywriting",
  "AI Image Generation",
  "Prompt Engineering",
  "AI Automation",
  "AI Video Editing",
  "Canva AI",
  "n8n Workflows",
  "Make.com",
  "Zapier",
  "AI Content Systems",
  "Generative AI",
];

const tickerRow3 = [
  "WordPress",
  "Elementor",
  "Analytics Dashboards",
  "Tag Manager",
  "Looker Studio",
  "Google Search Console",
  "Meta Business Suite",
  "Premiere Pro",
  "Canva",
  "MySQL",
  "Email Automation",
  "CRM Workflows",
  "Content Systems",
  "Brand Governance",
];

const personJsonLd = {
  "@context": "https://schema.org",
  "@type": "Person",
  name: profile.name,
  jobTitle: profile.roleTitle,
  description: profile.summary,
  url: profile.siteUrl,
  email: profile.email,
  address: { "@type": "PostalAddress", addressLocality: "Dubai", addressCountry: "AE" },
  sameAs: profile.instagram.map((i) => i.href),
};
---

<BaseLayout
  title={`${profile.name} | ${profile.roleTitle}`}
  description={profile.summary}
  path="/"
  jsonLd={personJsonLd}
>

<!-- HERO -->
<section
  class="hero-section relative overflow-hidden text-center"
  style="min-height: 100dvh; padding-top: clamp(90px, 10vh, 108px); padding-bottom: 24px;"
>

  <!-- BACKGROUNDS z-0 -->
  <div class="absolute inset-0 pointer-events-none" style="z-index:0; background: radial-gradient(ellipse 55% 65% at 50% -5%, rgba(37,99,235,0.55) 0%, rgba(37,99,235,0.18) 35%, transparent 70%);"></div>
  <div class="absolute inset-0 pointer-events-none" style="z-index:0; background: radial-gradient(ellipse 40% 40% at 50% 10%, rgba(96,165,250,0.22) 0%, transparent 60%);"></div>
  <div class="absolute inset-0 pointer-events-none" style="z-index:0; background-image: linear-gradient(rgba(255,255,255,0.022) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.022) 1px, transparent 1px); background-size: 72px 72px; mask-image: radial-gradient(ellipse 80% 70% at 50% 0%, black 0%, transparent 100%);"></div>
  <div class="absolute top-0 left-1/2 -translate-x-1/2 pointer-events-none" style="z-index:0; width:1px; height:45%; background: linear-gradient(180deg, rgba(147,197,253,0.7) 0%, rgba(37,99,235,0.3) 40%, transparent 100%); filter: blur(0.5px);"></div>
  <div class="absolute bottom-0 left-0 right-0 pointer-events-none" style="z-index:0; height:35%; background: linear-gradient(0deg, #07090f 0%, transparent 100%);"></div>


  <!-- STAGE: rings + portrait share same container so they stay aligned -->
  <div class="relative flex items-end justify-center mx-auto"
    style="z-index: 1; width: 100%; height: clamp(380px, 48vh, 500px); margin-bottom: -165px;">

    <!-- ORBITAL RINGS: fixed 360x360, centered in stage -->
    <div class="absolute pointer-events-none"
      style="width: 420px; height: 420px; top: 38%; left: 50%; transform: translate3d(-50%, -50%, 0); z-index: 0; will-change: transform; contain: layout style;">

      <!-- Ring 1: 360px diameter ? radius 180px -->
      <div class="absolute orbit-ring" style="inset: 0; border-radius: 50%; border: 1px solid rgba(147,197,253,0.18); animation: orbitSpin1 18s linear infinite;"></div>
      <!-- Ring 2: inset 14% ? diameter 259px ? radius 130px -->
      <div class="absolute orbit-ring" style="inset: 14%; border-radius: 50%; border: 1px solid rgba(37,99,235,0.28); animation: orbitSpin2 28s linear infinite reverse;"></div>
      <!-- Ring 3: inset 28% ? diameter 159px ? radius 79px -->
      <div class="absolute orbit-ring" style="inset: 28%; border-radius: 50%; border: 1px dashed rgba(147,197,253,0.13); animation: orbitSpin1 42s linear infinite;"></div>

      <!-- Dot 1: translateX(180px) matches Ring 1 radius exactly -->
      <div class="absolute orbit-dot" style="width:6px; height:6px; top:50%; left:50%; margin:-3px 0 0 -3px; border-radius:50%; background:#93c5fd; box-shadow: 0 0 10px rgba(147,197,253,0.95), 0 0 22px rgba(37,99,235,0.6); animation: dot1Orbit 18s linear infinite;"></div>
      <!-- Dot 2: translateX(130px) matches Ring 2 radius exactly -->
      <div class="absolute orbit-dot" style="width:5px; height:5px; top:50%; left:50%; margin:-2.5px 0 0 -2.5px; border-radius:50%; background:#ffffff; box-shadow: 0 0 8px rgba(255,255,255,0.95), 0 0 18px rgba(147,197,253,0.7); animation: dot2Orbit 28s linear infinite reverse;"></div>
      <!-- Dot 3: translateX(79px) matches Ring 3 radius exactly -->
      <div class="absolute orbit-dot" style="width:4px; height:4px; top:50%; left:50%; margin:-2px 0 0 -2px; border-radius:50%; background:#60a5fa; box-shadow: 0 0 8px rgba(96,165,250,0.95); animation: dot3Orbit 42s linear infinite;"></div>
    </div>

    <!-- PORTRAIT: z-index 1, bottom aligned in stage, behind name -->
    <div class="hero-portrait-layer pointer-events-none" style="position: relative; z-index: 1; width: clamp(340px, 44vw, 480px); height: 100%; flex-shrink: 0;">
      <img
        src="/profile.png"
        alt=""
        aria-hidden="true"
        class="absolute inset-0 w-full h-full"
        style="
          object-fit: contain;
          object-position: bottom;
          z-index: 0;
          opacity: 0.30;
          filter:
            blur(28px)
            brightness(0.35)
            saturate(2.0)
            hue-rotate(-20deg)
            drop-shadow(0 0 40px rgba(37,99,235,0.9));
          mix-blend-mode: screen;
          pointer-events: none;
        "
        decoding="async"
        loading="eager"
      />
      <img
        src="/profile.png"
        alt="Muhammed Mubashir V"
        width="270"
        height="420"
        loading="eager"
        fetchpriority="high"
        decoding="async"
        class="block w-full h-full"
        style="object-fit: contain; object-position: bottom; mix-blend-mode: screen; z-index: 1; position: relative; filter:
          drop-shadow(0 0 6px rgba(37,99,235,0.50))
          drop-shadow(0 0 18px rgba(37,99,235,0.28))
          drop-shadow(0 0 50px rgba(37,99,235,0.12))
          brightness(1.02) contrast(1.05) saturate(0.92);"
      />
      <!-- Edge dissolve mask -->
      <div class="absolute inset-0" style="-webkit-mask-image: radial-gradient(ellipse 88% 90% at 50% 40%, black 20%, transparent 72%), linear-gradient(0deg, transparent 0%, black 28%, black 100%); -webkit-mask-composite: source-in; mask-image: radial-gradient(ellipse 88% 90% at 50% 40%, black 20%, transparent 72%), linear-gradient(0deg, transparent 0%, black 28%, black 100%); mask-composite: intersect;"></div>
      <!-- Bottom ground fog: portrait feet melt into baseline -->
      <div class="absolute bottom-0 left-0 right-0 pointer-events-none" style="height: 38%; background: linear-gradient(0deg, #07090f 0%, #07090f 10%, rgba(7,9,15,0.88) 22%, rgba(7,9,15,0.55) 42%, transparent 100%);"></div>
    </div>
    <!-- Full-width ground shadow - extends portrait fade to screen edges -->
    <div class="absolute bottom-0 left-0 right-0 pointer-events-none" style="
      height: 55%;
      z-index: 2;
      background:
        radial-gradient(ellipse 60% 80% at 20% 100%, rgba(7,9,15,0.80) 0%, transparent 70%),
        radial-gradient(ellipse 60% 80% at 80% 100%, rgba(7,9,15,0.80) 0%, transparent 70%),
        linear-gradient(0deg,
          rgba(7,9,15,0.72) 0%,
          rgba(7,9,15,0.45) 30%,
          rgba(7,9,15,0.15) 60%,
          transparent 100%);
    "></div>
  </div>
  <!-- END STAGE -->


  <!-- CONTENT COLUMN: z-index 2, sits above stage/portrait -->
  <div class="relative flex flex-col items-center px-4" style="z-index: 2;">

    <!-- EYEBROW PILL -->
    <div class="reveal flex items-center justify-center mb-3" data-delay="0.10">
      <span class="inline-flex items-center gap-2 rounded-full px-4 py-1.5 text-xs font-mono tracking-widest uppercase" style="background: rgba(37,99,235,0.12); border: 1px solid rgba(37,99,235,0.30); color: #93c5fd;">
        <span class="w-1.5 h-1.5 rounded-full inline-block" style="background:#93c5fd; box-shadow: 0 0 6px rgba(147,197,253,0.8); animation: pulse 2s ease-in-out infinite;"></span>
        {profile.location} &nbsp;&middot;&nbsp; Open to new mandates
      </span>
    </div>

    <!-- NAME + SHADE + REFLECTION + BASELINE (single wrapper) -->
    <div class="relative w-full flex flex-col items-center" style="isolation: isolate;">

      <!-- Dark shade behind name -->
      <div class="absolute pointer-events-none" style="inset-inline: 0; top: -180px; height: calc(100% + 180px); bottom: auto; background: radial-gradient(ellipse 80% 100% at 50% 100%, rgba(7,9,15,0.65) 0%, rgba(7,9,15,0.40) 35%, transparent 75%); z-index: 0;"></div>

      <!-- Name H1 -->
      <div class="reveal" data-delay="0.15" style="position: relative; z-index: 2; margin-top: 6px;">
        <h1 class="hero-name text-center uppercase" style="font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 3rem; letter-spacing: 0.18em; line-height: 1.1; color: #e8edf8; text-shadow: 0 2px 30px rgba(7,9,15,0.9), 0 4px 60px rgba(7,9,15,0.7), 0 0 40px rgba(37,99,235,0.15);">
          {profile.name}
        </h1>
        <!-- Reflection -->
        <div style="height: 26px; margin-top: -2px; overflow: hidden; pointer-events: none;">
          <h1 class="text-center uppercase" style="font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 3rem; letter-spacing: 0.18em; line-height: 1.1; color: #e8edf8; transform: scaleY(-1); opacity: 0.16; -webkit-mask-image: linear-gradient(0deg, transparent 0%, rgba(0,0,0,0.55) 100%); mask-image: linear-gradient(0deg, transparent 0%, rgba(0,0,0,0.55) 100%);">
            {profile.name}
          </h1>
        </div>
      </div>

      <!-- GLOW BASELINE -->
      <div class="hero-glow-baseline reveal mx-auto" data-delay="0.16" style="position: relative; z-index: 2; height: 1px; width: clamp(200px, 55%, 420px); margin-top: 0px; margin-bottom: 0; background: linear-gradient(90deg, transparent 0%, rgba(147,197,253,0.45) 20%, rgba(255,255,255,0.90) 50%, rgba(147,197,253,0.45) 80%, transparent 100%); box-shadow: 0 0 12px rgba(147,197,253,0.5), 0 0 28px rgba(37,99,235,0.35), 0 2px 40px rgba(37,99,235,0.15);"></div>
    </div>

    <!-- ROLE -->
    <div class="reveal mt-2" data-delay="0.20">
      <p class="text-base md:text-lg font-medium text-slate-300 tracking-wide">{profile.roleTitle}</p>
    </div>

    <!-- DISCIPLINES -->
    <div class="reveal mt-4" data-delay="0.24">
      <p class="text-xs font-mono tracking-[0.28em] uppercase" style="color: rgba(147,197,253,0.65);">{profile.headline}</p>
    </div>

    <!-- CTAs -->
    <div class="reveal mt-10" data-delay="0.34">
      <div class="inline-flex items-center gap-1 rounded-full p-1.5" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.12); backdrop-filter: blur(20px);">
        <a href={profile.links.whatsapp} target="_blank" rel="noreferrer"
          class="rounded-full px-5 py-2 text-xs font-semibold text-white transition-all duration-300 hover:scale-[1.02]"
          style="background: linear-gradient(135deg, #2563eb, #1d4ed8); box-shadow: 0 2px 16px rgba(37,99,235,0.5);">
          <ArrowUpRight client:visible size={14} strokeWidth={2.2} /> WhatsApp
        </a>
        <a href="/work" class="rounded-full px-5 py-2 text-xs font-medium text-slate-400 hover:text-white transition-colors duration-200">Work</a>
        <a href="/about" class="rounded-full px-5 py-2 text-xs font-medium text-slate-400 hover:text-white transition-colors duration-200">About</a>
        <span class="w-px h-4 mx-1" style="background: rgba(255,255,255,0.12);"></span>
        <a href="/contact" class="rounded-full px-5 py-2 text-xs font-medium transition-all duration-200" style="background: rgba(255,255,255,0.08); color: #e2e8f0;">
          Contact <ArrowUpRight client:visible size={14} strokeWidth={2.2} />
        </a>
      </div>
    </div>

    <!-- SOCIAL PROOF -->
    <div class="reveal hero-social-proof flex items-center justify-center gap-3 mt-8 mb-6" data-delay="0.40">
      <div class="flex -space-x-2">
        {['M','B','R'].map((l) => (
          <div class="w-6 h-6 rounded-full flex items-center justify-center text-white border border-obsidian" style="background: linear-gradient(135deg, #2563eb, #93c5fd); font-size: 0.55rem; font-weight: 700;">
            {l}
          </div>
        ))}
      </div>
      <p class="text-xs font-mono text-slate-600">2,300+ verified leads delivered across UAE campaigns</p>
    </div>

  </div>
  <!-- END CONTENT COLUMN -->


</section>


<!-- ----------------------------------------------
     TICKER STRIP ï¿½ 3 ROW LOOP
----------------------------------------------- -->
<div class="ticker-section relative border-y mt-10" style="border-color: rgba(255,255,255,0.06); overflow: hidden; padding: 8px 0;">

  <!-- Left gradient fade mask -->
  <div class="absolute left-0 top-0 h-full z-10 pointer-events-none"
    style="width: 140px; background: linear-gradient(90deg, #07090f 0%, #07090f 25%, transparent 100%);">
  </div>

  <!-- Right gradient fade mask -->
  <div class="absolute right-0 top-0 h-full z-10 pointer-events-none"
    style="width: 140px; background: linear-gradient(270deg, #07090f 0%, #07090f 25%, transparent 100%);">
  </div>

  <!-- ROW 1 ï¿½ Marketing skills, medium speed -->
  <div class="ticker-row-wrap" style="padding: 10px 0 6px;">
    <div class="ticker-row row-1">
      {[...tickerRow1, ...tickerRow1, ...tickerRow1, ...tickerRow1].map((item, i) => (
        <span class="ticker-item" style={`--glow-delay: ${(i * 1.3) % 9}s;`}>
          <span class="ticker-dot">&middot;</span>
          <span class="ticker-text">{item}</span>
        </span>
      ))}
    </div>
  </div>

  <!-- ROW 2 ï¿½ AI tools, slower -->
  <div class="ticker-row-wrap" style="padding: 6px 0;">
    <div class="ticker-row row-2">
      {[...tickerRow2, ...tickerRow2, ...tickerRow2, ...tickerRow2].map((item, i) => (
        <span class="ticker-item" style={`--glow-delay: ${(i * 1.7) % 11}s;`}>
          <span class="ticker-dot">&middot;</span>
          <span class="ticker-text">{item}</span>
        </span>
      ))}
    </div>
  </div>

  <!-- ROW 3 ï¿½ Web & design tools, faster -->
  <div class="ticker-row-wrap" style="padding: 6px 0 10px;">
    <div class="ticker-row row-3">
      {[...tickerRow3, ...tickerRow3, ...tickerRow3, ...tickerRow3].map((item, i) => (
        <span class="ticker-item" style={`--glow-delay: ${(i * 0.9) % 7}s;`}>
          <span class="ticker-dot">&middot;</span>
          <span class="ticker-text">{item}</span>
        </span>
      ))}
    </div>
  </div>

</div>


<!-- ----------------------------------------------
     METRICS
----------------------------------------------- -->
<section class="py-20 px-4">
  <div class="mx-auto max-w-6xl">
    <div class="glass-panel-ultra rounded-3xl px-8 py-10 md:px-12 md:py-12">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 md:gap-0 md:divide-x"
        style="divide-color: rgba(255,255,255,0.08);">

        <!-- Card 0: drops from above -->
        <div class="metric-card metric-drop space-y-2" data-metric="0" style="position: relative; overflow: hidden;">
          <p class="font-display font-bold text-white" style="font-size: clamp(2rem, 4vw, 2.8rem); letter-spacing: -0.04em;">
            <AnimatedCounter client:idle value={profile.impactMetrics[0].value} />
          </p>
          <p class="text-sm font-medium text-accent-soft">{profile.impactMetrics[0].label}</p>
          <p class="text-xs text-slate-500 leading-relaxed">{profile.impactMetrics[0].detail}</p>
        </div>

        <!-- Card 1: slides from left -->
        <div class="metric-card metric-slide-left space-y-2 md:pl-8" data-metric="1" style="position: relative; overflow: hidden;">
          <p class="font-display font-bold text-white" style="font-size: clamp(2rem, 4vw, 2.8rem); letter-spacing: -0.04em;">
            <AnimatedCounter client:idle value={profile.impactMetrics[1].value} />
          </p>
          <p class="text-sm font-medium text-accent-soft">{profile.impactMetrics[1].label}</p>
          <p class="text-xs text-slate-500 leading-relaxed">{profile.impactMetrics[1].detail}</p>
        </div>

        <!-- Card 2: rises from below -->
        <div class="metric-card metric-rise space-y-2 md:pl-8" data-metric="2" style="position: relative; overflow: hidden;">
          <p class="font-display font-bold text-white" style="font-size: clamp(2rem, 4vw, 2.8rem); letter-spacing: -0.04em;">
            <AnimatedCounter client:idle value={profile.impactMetrics[2].value} />
          </p>
          <p class="text-sm font-medium text-accent-soft">{profile.impactMetrics[2].label}</p>
          <p class="text-xs text-slate-500 leading-relaxed">{profile.impactMetrics[2].detail}</p>
        </div>

        <!-- Card 3: slides from right -->
        <div class="metric-card metric-slide-right space-y-2 md:pl-8" data-metric="3" style="position: relative; overflow: hidden;">
          <p class="font-display font-bold text-white" style="font-size: clamp(2rem, 4vw, 2.8rem); letter-spacing: -0.04em;">
            <AnimatedCounter client:idle value={profile.impactMetrics[3].value} />
          </p>
          <p class="text-sm font-medium text-accent-soft">{profile.impactMetrics[3].label}</p>
          <p class="text-xs text-slate-500 leading-relaxed">{profile.impactMetrics[3].detail}</p>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- ----------------------------------------------
     CAPABILITIES
----------------------------------------------- -->
<section class="py-20 px-4 section-border">
  <div class="mx-auto max-w-6xl">
    <!-- Header -->
    <div class="reveal mb-14" data-delay="0.15">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
        <h2 class="font-display font-semibold text-white text-balance"
          style="font-size: clamp(1.8rem, 3.5vw, 2.5rem); letter-spacing: -0.03em; max-width: 28ch;">
          Digital systems built<br/>for predictable growth
        </h2>
        <p class="text-sm text-slate-500 max-w-xs leading-relaxed">
          Lean, operator-led execution across strategy, performance, and measurement.
        </p>
      </div>
    </div>

    <!-- Grid -->
    <div class="cap-bento-grid mt-12">
      {profile.capabilities.map((cap, i) => {
        const iconName = capabilityIconNames[i] ?? "growth";
        const media = capabilityMedia[i as keyof typeof capabilityMedia];
        return (
          <div
            class={`cap-card cap-card-${i} glass-panel ring-hover rounded-2xl p-6 group cursor-default`}
            data-cap-index={String(i)}
            style={`grid-area: c${i}; transition: all 0.3s cubic-bezier(0.22,1,0.36,1);`}
          >
            {media?.position === "top" && (
              <div class="cap-media-shell cap-media-top">
                <div class="cap-media-frame">
                  <video
                    class="cap-media-image cap-media-video"
                    autoplay
                    muted
                    loop
                    playsinline
                    preload="none"
                    poster={media.poster}
                    data-src={media.src}
                    aria-hidden="true"
                  >
                  </video>
                  <div class="cap-media-overlay" aria-hidden="true"></div>
                </div>
              </div>
            )}
            <div class="flex items-start justify-between mb-4">
              <div class="cap-icon text-accent-soft/60 group-hover:text-accent-soft transition-colors" style="filter: drop-shadow(0 0 6px rgba(147,197,253,0.4));">
                <CapabilityIcon client:visible name={iconName} />
              </div>
              <span class="text-xs font-mono text-slate-700 group-hover:text-slate-500 transition-colors">
                0{i + 1}
              </span>
            </div>
            <h3 class="font-display font-semibold text-white text-base mb-2">{cap.title}</h3>
            <p class="text-sm text-slate-400 leading-relaxed">{cap.description}</p>
            {media?.position === "bottom" && (
              <div class="cap-media-shell cap-media-bottom">
                <div class="cap-media-frame">
                  <video
                    class="cap-media-image cap-media-video"
                    autoplay
                    muted
                    loop
                    playsinline
                    preload="none"
                    poster={media.poster}
                    data-src={media.src}
                    aria-hidden="true"
                  >
                  </video>
                  <div class="cap-media-overlay" aria-hidden="true"></div>
                </div>
              </div>
            )}
          </div>
        );
      })}
    </div>
  </div>
</section>


<!-- ----------------------------------------------
     FEATURED WORK ï¿½ ALEX MAREX LAYOUT
----------------------------------------------- -->
<section class="work-section py-24 px-6 section-border" id="work">
  <div class="mx-auto max-w-6xl">

    <!-- --- ROW 1: Left title + Right two stacked cards --- -->
    <div class="grid lg:grid-cols-2 gap-10 lg:gap-16 items-start mb-16">

      <!-- LEFT: Heading block -->
      <div class="work-left">
        <div class="reveal" data-delay="0.08">
          <h2 class="font-display font-bold text-white mb-6 text-balance"
            style="font-size: clamp(2.2rem, 5vw, 3.8rem); letter-spacing: -0.03em; line-height: 1.05;">
            Featured work
          </h2>
        </div>
        <div class="reveal" data-delay="0.12">
          <p class="text-sm text-slate-400 leading-loose max-w-sm mb-8">
            Selected projects with measurable operational and growth outcomes across UAE markets.
          </p>
        </div>
        <div class="reveal" data-delay="0.16">
          <a href="/work"
            class="inline-flex items-center gap-2 rounded-full px-6 py-2.5 text-sm font-medium transition-all duration-300 group"
            style="border: 1px solid rgba(255,255,255,0.12); color: #93c5fd; background: rgba(37,99,235,0.08);"
            onmouseover="this.style.background='rgba(37,99,235,0.18)'; this.style.borderColor='rgba(147,197,253,0.35)'"
            onmouseout="this.style.background='rgba(37,99,235,0.08)'; this.style.borderColor='rgba(255,255,255,0.12)'">
            <Zap client:visible size={13} strokeWidth={2} /> View all projects
          </a>
        </div>

        <!-- Metric callout under heading on desktop -->
        <div class="reveal hidden lg:block mt-12 pt-10 border-t" style="border-color: rgba(255,255,255,0.06);" data-delay="0.20">
          <p class="text-xs font-mono tracking-widest uppercase text-slate-600 mb-3">Results at a glance</p>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="font-display font-bold text-white text-2xl" style="letter-spacing: -0.04em;">1000+</p>
              <p class="text-xs text-slate-500 mt-0.5">Verified leads in 6 months</p>
            </div>
            <div>
              <p class="font-display font-bold text-white text-2xl" style="letter-spacing: -0.04em;">4+</p>
              <p class="text-xs text-slate-500 mt-0.5">Industries served in UAE</p>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Two stacked glass cards -->
      <div class="flex flex-col gap-5">

        <!-- Card 1 ï¿½ 180 Degree -->
        <a href="/work/180-degree-meal-planner"
          class="work-card-right work-card-1 group block rounded-2xl overflow-hidden transition-all duration-500 hover:-translate-y-1"
          style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.10); backdrop-filter: blur(20px);">

          <!-- Image area -->
          <div class="relative overflow-hidden" style="height: 180px; background: rgba(37,99,235,0.08);">
            <!-- Placeholder ï¿½ replace src with real screenshot -->
            <div class="w-full h-full flex items-center justify-center"
              style="background: linear-gradient(135deg, rgba(37,99,235,0.15) 0%, rgba(7,9,15,0.8) 100%);">
              <div class="text-center">
                <div class="text-3xl mb-2 opacity-30">?</div>
                <p class="text-xs font-mono text-slate-600 uppercase tracking-widest">Add screenshot</p>
                <p class="text-xs text-slate-700 font-mono mt-1">Replace with: /work-1.jpg</p>
              </div>
            </div>
            <!-- Uncomment and add your image:
            <img src="/work-1.jpg" alt="180 Degree project"
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
            -->
            <!-- Category badge -->
            <div class="absolute top-3 left-3">
              <span class="text-xs font-mono uppercase tracking-widest px-2.5 py-1 rounded-full"
                style="background: rgba(7,9,15,0.75); border: 1px solid rgba(255,255,255,0.10); color: #93c5fd; backdrop-filter: blur(10px);">
                Web App / Growth Ops
              </span>
            </div>
            <div class="absolute top-3 right-3">
              <span class="text-xs font-mono text-slate-600">01</span>
            </div>
          </div>

          <!-- Content -->
          <div class="p-5">
            <h3 class="font-display font-semibold text-white text-base mb-1 group-hover:text-accent-soft transition-colors">
              Healthy Meal Plans + Web App Plugin
            </h3>
            <p class="text-xs font-mono text-slate-600 mb-3">2025</p>
            <p class="text-sm text-slate-400 leading-relaxed">
              Built a structured meal-planner system with plugin workflows and operational controls for plan management.
            </p>
            <div class="flex flex-wrap gap-2 mt-4">
              {["WordPress", "Elementor", "MySQL"].map((t) => (
                <span class="text-xs px-2.5 py-1 rounded-full font-mono text-slate-600"
                  style="border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03);">
                  {t}
                </span>
              ))}
            </div>
            <p class="text-xs font-mono text-slate-600 mt-4 group-hover:text-accent-soft transition-colors">
              View case study <ArrowRight client:visible size={13} strokeWidth={2} />
            </p>
          </div>
        </a>

        <!-- Card 2 ï¿½ bluemark -->
        <a href="/work/bluemark-real-estate-leadgen"
          class="work-card-right work-card-2 group block rounded-2xl overflow-hidden transition-all duration-500 hover:-translate-y-1"
          style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.10); backdrop-filter: blur(20px);">

          <!-- Image area -->
          <div class="relative overflow-hidden" style="height: 180px;">
            <div class="w-full h-full flex items-center justify-center"
              style="background: linear-gradient(135deg, rgba(37,99,235,0.12) 0%, rgba(7,9,15,0.85) 100%);">
              <div class="text-center">
                <div class="text-3xl mb-2 opacity-30">?</div>
                <p class="text-xs font-mono text-slate-600 uppercase tracking-widest">Add screenshot</p>
                <p class="text-xs text-slate-700 font-mono mt-1">Replace with: /work-2.jpg</p>
              </div>
            </div>
            <!-- Uncomment and add your image:
            <img src="/work-2.jpg" alt="bluemark project"
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
            -->
            <div class="absolute top-3 left-3">
              <span class="text-xs font-mono uppercase tracking-widest px-2.5 py-1 rounded-full"
                style="background: rgba(7,9,15,0.75); border: 1px solid rgba(255,255,255,0.10); color: #93c5fd; backdrop-filter: blur(10px);">
                Performance Marketing
              </span>
            </div>
            <div class="absolute top-3 right-3">
              <span class="text-xs font-mono text-slate-600">02</span>
            </div>
          </div>

          <!-- Content -->
          <div class="p-5">
            <h3 class="font-display font-semibold text-white text-base mb-1 group-hover:text-accent-soft transition-colors">
              bluemark Real Estate &ndash; Luxury Lead Gen System
            </h3>
            <p class="text-xs font-mono text-slate-600 mb-3">Jan 2025 &ndash; Jul 2025</p>
            <p class="text-sm text-slate-400 leading-relaxed">
              Developed a real-estate lead engine using creative testing, segmented audience strategy, and WhatsApp-first follow-up flows.
            </p>
            <div class="flex flex-wrap gap-2 mt-4">
              {["Meta Ads Manager", "Canva", "Premiere Pro"].map((t) => (
                <span class="text-xs px-2.5 py-1 rounded-full font-mono text-slate-600"
                  style="border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03);">
                  {t}
                </span>
              ))}
            </div>
            <p class="text-xs font-mono text-slate-600 mt-4 group-hover:text-accent-soft transition-colors">
              View case study <ArrowRight client:visible size={13} strokeWidth={2} />
            </p>
          </div>
        </a>

      </div>
    </div>


    <!-- --- ROW 2: 3-column stagger (like reference "Features" block) --- -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-5 items-end">

      <!-- Left card ï¿½ offset DOWN -->
      <a href="/work/raslan-bc-growth"
        class="work-card-bottom work-card-3 group block rounded-2xl overflow-hidden transition-all duration-500 hover:-translate-y-1"
        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.10); backdrop-filter: blur(20px); margin-top: 60px;">

        <!-- Image -->
        <div class="relative overflow-hidden" style="height: 140px;">
          <div class="w-full h-full flex items-center justify-center"
            style="background: linear-gradient(135deg, rgba(15,23,42,0.9) 0%, rgba(37,99,235,0.08) 100%);">
            <div class="text-center">
              <div class="text-2xl mb-1 opacity-25">?</div>
              <p class="text-xs font-mono text-slate-700 uppercase tracking-widest">work-3.jpg</p>
            </div>
          </div>
          <!-- Uncomment:
          <img src="/work-3.jpg" alt="Raslan BC"
            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
          -->
          <div class="absolute top-3 left-3">
            <span class="text-xs font-mono uppercase tracking-widest px-2.5 py-1 rounded-full"
              style="background: rgba(7,9,15,0.75); border: 1px solid rgba(37,99,235,0.30); color: #93c5fd; backdrop-filter: blur(10px);">
              Brand + Funnel
            </span>
          </div>
        </div>

        <div class="p-5">
          <h3 class="font-display font-semibold text-white text-sm mb-2 group-hover:text-accent-soft transition-colors">
            Raslan BC &ndash; Construction Growth
          </h3>
          <p class="text-xs text-slate-500 leading-relaxed mb-4">
            Strengthened demand generation through messaging clarity, portfolio storytelling, and lead-path simplification.
          </p>
          <div class="flex items-center justify-between">
            <span class="text-xs font-mono text-slate-700">2025</span>
            <span class="text-xs font-mono text-slate-600 group-hover:text-accent-soft transition-colors">
              Learn more <ArrowRight client:visible size={13} strokeWidth={2} />
            </span>
          </div>
        </div>
      </a>

      <!-- CENTER image card ï¿½ tall, no offset -->
      <div class="work-card-bottom work-card-center rounded-2xl overflow-hidden relative"
        style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); backdrop-filter: blur(20px); min-height: 380px;">

        <!-- Placeholder center image ï¿½ replace with your brand/campaign photo -->
        <div class="w-full h-full absolute inset-0 flex items-center justify-center"
          style="background: linear-gradient(160deg, rgba(37,99,235,0.18) 0%, rgba(7,9,15,0.95) 100%);">
          <div class="text-center p-8">
            <div class="text-4xl mb-3 opacity-20">?</div>
            <p class="text-xs font-mono text-slate-600 uppercase tracking-widest mb-1">Feature image</p>
            <p class="text-xs text-slate-700 font-mono">Replace with:</p>
            <p class="text-xs text-slate-700 font-mono">/work-center.jpg</p>
          </div>
        </div>
        <!-- Uncomment:
        <img src="/work-center.jpg" alt="Featured"
          class="w-full h-full object-cover absolute inset-0" />
        -->

        <!-- Overlay gradient -->
        <div class="absolute inset-0 pointer-events-none"
          style="background: linear-gradient(0deg, rgba(7,9,15,0.85) 0%, transparent 50%);">
        </div>

        <!-- Bottom content overlay -->
        <div class="absolute bottom-0 left-0 right-0 p-5 z-10">
          <p class="text-xs font-mono tracking-widest uppercase text-accent-soft/60 mb-2">Digital Operations</p>
          <h3 class="font-display font-semibold text-white text-base mb-1">
            Multi-Company Digital Ops
          </h3>
          <p class="text-xs text-slate-400">Jul 2025 &ndash; Jan 2026</p>
          <a href="/work/multi-company-digital-ops"
            class="inline-flex items-center gap-1.5 mt-4 text-xs font-mono text-accent-soft/70 hover:text-accent-soft transition-colors">
            View case study <ArrowRight client:visible size={13} strokeWidth={2} />
          </a>
        </div>

        <!-- Index badge -->
        <div class="absolute top-4 right-4">
          <span class="text-xs font-mono text-slate-700">03</span>
        </div>
      </div>

      <!-- Right card ï¿½ offset UP -->
      <a href="/work/raslan-media-content-performance"
        class="work-card-bottom work-card-4 group block rounded-2xl overflow-hidden transition-all duration-500 hover:-translate-y-1"
        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.10); backdrop-filter: blur(20px); margin-bottom: 60px;">

        <!-- Image -->
        <div class="relative overflow-hidden" style="height: 140px;">
          <div class="w-full h-full flex items-center justify-center"
            style="background: linear-gradient(135deg, rgba(15,23,42,0.9) 0%, rgba(37,99,235,0.08) 100%);">
            <div class="text-center">
              <div class="text-2xl mb-1 opacity-25">?</div>
              <p class="text-xs font-mono text-slate-700 uppercase tracking-widest">work-4.jpg</p>
            </div>
          </div>
          <!-- Uncomment:
          <img src="/work-4.jpg" alt="Raslan Media"
            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
          -->
          <div class="absolute top-3 right-3">
            <span class="text-xs font-mono text-slate-600">04</span>
          </div>
        </div>

        <div class="p-5">
          <h3 class="font-display font-semibold text-white text-sm mb-2 group-hover:text-accent-soft transition-colors">
            Raslan Media &ndash; Content System + Performance
          </h3>
          <p class="text-xs text-slate-500 leading-relaxed mb-4">
            Built repeatable content and campaign workflows to support regular publishing and measurable growth loops.
          </p>
          <div class="flex items-center justify-between">
            <span class="text-xs font-mono text-slate-700">2025</span>
            <span class="text-xs font-mono text-slate-600 group-hover:text-accent-soft transition-colors">
              Learn more <ArrowRight client:visible size={13} strokeWidth={2} />
            </span>
          </div>
        </div>
      </a>

    </div>

  </div>
</section>


<!-- TESTIMONIALS — 3-ROW PARALLAX SCROLL -->
<section class="py-20 section-border overflow-hidden" id="testi-section">
  <div class="mx-auto max-w-6xl px-4">
    <div class="reveal mb-14 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-6" data-delay="0.05">
      <div>
        <p class="text-xs font-mono uppercase tracking-[0.3em] text-accent-soft/70 mb-4">Testimonials</p>
        <h2 class="font-display font-semibold text-white"
          style="font-size: clamp(1.8rem, 3.5vw, 2.5rem); letter-spacing: -0.03em;">
          What partners say
        </h2>
      </div>
      <button id="testi-open-btn"
        class="inline-flex items-center gap-2 rounded-full px-6 py-2.5 text-sm font-medium text-white self-start sm:self-auto flex-shrink-0"
        style="background: rgba(37,99,235,0.18); border: 1px solid rgba(37,99,235,0.40); backdrop-filter: blur(12px); transition: all 0.25s ease;">
        <Plus client:visible size={14} strokeWidth={2.2} color="#93c5fd" /> Leave a testimonial
      </button>
    </div>
  </div>

  <!-- ROW 1 — scrolls right -->
  <div class="testi-row-wrap mb-4" style="mask-image: linear-gradient(90deg,transparent 0%,black 6%,black 94%,transparent 100%); -webkit-mask-image: linear-gradient(90deg,transparent 0%,black 6%,black 94%,transparent 100%);">
    <div class="testi-row" id="testi-row-1" data-direction="1" style="display:flex; gap:14px; width:max-content;">
    </div>
  </div>

  <!-- ROW 2 — scrolls left -->
  <div class="testi-row-wrap mb-4" style="mask-image: linear-gradient(90deg,transparent 0%,black 6%,black 94%,transparent 100%); -webkit-mask-image: linear-gradient(90deg,transparent 0%,black 6%,black 94%,transparent 100%);">
    <div class="testi-row" id="testi-row-2" data-direction="-1" style="display:flex; gap:14px; width:max-content;">
    </div>
  </div>

  <!-- ROW 3 — scrolls right -->
  <div class="testi-row-wrap" style="mask-image: linear-gradient(90deg,transparent 0%,black 6%,black 94%,transparent 100%); -webkit-mask-image: linear-gradient(90deg,transparent 0%,black 6%,black 94%,transparent 100%);">
    <div class="testi-row" id="testi-row-3" data-direction="1" style="display:flex; gap:14px; width:max-content;">
    </div>
  </div>

  <div class="mx-auto max-w-6xl px-4 mt-10">
    <p class="reveal text-sm text-slate-600 italic border-l-2 border-accent/25 pl-4" data-delay="0.2">
      {testimonials.requestLine}
    </p>
  </div>

  <!-- SUBMIT MODAL -->
  <div id="testi-modal" style="display:none; position:fixed; inset:0; z-index:50; align-items:center; justify-content:center; padding:1rem; background:rgba(0,0,0,0.75); backdrop-filter:blur(8px);">
    <div class="relative w-full max-w-md rounded-2xl p-8"
      style="background:rgba(12,18,40,0.98); border:1px solid rgba(147,197,253,0.20); box-shadow:0 32px 80px rgba(0,0,0,0.6);">
      <button id="testi-close-btn" style="position:absolute; top:1rem; right:1rem; color:#64748b; font-size:1.2rem; background:none; border:none; cursor:pointer;">&#215;</button>
      <h3 class="font-display font-semibold text-white text-lg mb-6">Share your experience</h3>

      <!-- Photo upload area -->
      <div class="mb-5">
        <label class="block text-xs font-mono uppercase tracking-widest text-slate-500 mb-2">Photo (optional)</label>
        <div style="display:flex; align-items:center; gap:14px;">
          <div id="testi-avatar-preview" style="
            width:52px; height:52px; border-radius:50%; overflow:hidden; flex-shrink:0;
            background:linear-gradient(135deg,rgba(37,99,235,0.7),rgba(147,197,253,0.4));
            border:1px solid rgba(147,197,253,0.25);
            display:flex; align-items:center; justify-content:center;
            font-size:1.1rem; font-weight:700; color:#fff;
            font-family:'DM Mono',monospace;">
            ?
          </div>
          <label for="testi-photo-input" style="
            display:inline-flex; align-items:center; gap:6px;
            padding:6px 14px; border-radius:99px; cursor:pointer;
            background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12);
            color:#94a3b8; font-size:0.72rem; font-family:'DM Mono',monospace;
            letter-spacing:0.05em; text-transform:uppercase; transition:all 0.2s ease;">
            &#8679; Upload photo
          </label>
          <input id="testi-photo-input" type="file" accept="image/*" style="display:none;" />
        </div>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-xs font-mono uppercase tracking-widest text-slate-500 mb-1.5">Your name</label>
          <input id="testi-name" type="text" placeholder="e.g. Ahmed Al Mansouri"
            class="w-full rounded-xl px-4 py-2.5 text-sm text-white placeholder-slate-600 outline-none"
            style="background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.10); transition:border-color 0.2s ease;" />
        </div>
        <div>
          <label class="block text-xs font-mono uppercase tracking-widest text-slate-500 mb-1.5">Your role &amp; company</label>
          <input id="testi-role" type="text" placeholder="e.g. Marketing Director · XYZ Group"
            class="w-full rounded-xl px-4 py-2.5 text-sm text-white placeholder-slate-600 outline-none"
            style="background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.10); transition:border-color 0.2s ease;" />
        </div>
        <div>
          <label class="block text-xs font-mono uppercase tracking-widest text-slate-500 mb-1.5">Your testimonial</label>
          <textarea id="testi-quote" rows="4" placeholder="What was your experience working together?"
            class="w-full rounded-xl px-4 py-2.5 text-sm text-white placeholder-slate-600 outline-none resize-none"
            style="background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.10); transition:border-color 0.2s ease;"></textarea>
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button id="testi-submit-btn"
          class="flex-1 rounded-xl py-2.5 text-sm font-semibold text-white transition-all duration-200 hover:scale-[1.02]"
          style="background:linear-gradient(135deg,#2563eb,#1d4ed8); box-shadow:0 4px 20px rgba(37,99,235,0.4);">
          Submit testimonial
        </button>
        <button id="testi-cancel-btn"
          class="rounded-xl px-5 py-2.5 text-sm text-slate-400 hover:text-white transition-colors"
          style="background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08);">
          Cancel
        </button>
      </div>
      <p id="testi-success" class="mt-4 text-sm text-green-400 font-mono text-center" style="display:none;">
        &#10003; Thank you! Your testimonial has been added.
      </p>
    </div>
  </div>
</section>


<!-- ----------------------------------------------
     FINAL CTA
----------------------------------------------- -->
<section class="py-20 px-4 section-border">
  <div class="mx-auto max-w-6xl">
    <div class="reveal glass-panel-ultra rounded-3xl relative overflow-hidden" data-delay="0.05"
      style="min-height: 240px;">

      <!-- Background glow -->
      <div class="absolute -top-24 -right-24 w-80 h-80 rounded-full pointer-events-none"
        style="background: radial-gradient(circle, rgba(37,99,235,0.22) 0%, transparent 70%); filter: blur(40px);">
      </div>
      <!-- Extra right-side glow for graph area -->
      <div class="absolute top-0 right-0 bottom-0 w-2/3 pointer-events-none"
        style="background: radial-gradient(ellipse 80% 100% at 100% 60%, rgba(37,99,235,0.18) 0%, transparent 65%); filter: blur(20px);">
      </div>

      <!-- Dark shade: full on mobile, left-fade on desktop -->
      <div class="absolute inset-0 pointer-events-none" style="
        z-index: 1;
        background:
          linear-gradient(90deg,
            rgba(7,9,15,0.92) 0%,
            rgba(7,9,15,0.85) 35%,
            rgba(7,9,15,0.70) 55%,
            rgba(7,9,15,0.10) 75%,
            transparent 100%);
      "></div>

      <!-- Mobile-only: extra full-cover shade so text is readable -->
      <div class="absolute inset-0 pointer-events-none md:hidden" style="
        z-index: 1;
        background: rgba(7,9,15,0.70);
      "></div>

      <!-- Left: text content -->
      <div class="relative px-8 py-12 md:px-12 md:py-12 max-w-md" style="z-index: 2;">
        <p class="text-xs font-mono uppercase tracking-[0.3em] text-accent-soft/70 mb-5">Start a Conversation</p>
        <h2 class="font-display font-bold text-white mb-4 text-balance"
          style="font-size: clamp(1.8rem, 3.5vw, 2.8rem); letter-spacing: -0.035em;">
          {profile.finalCta.title}
        </h2>
        <p class="text-base text-slate-400 leading-relaxed mb-8 max-w-md">
          {profile.finalCta.description}
        </p>
        <div class="flex flex-row flex-wrap gap-3 items-center">
          <a
            href={profile.links.whatsapp}
            target="_blank"
            rel="noreferrer"
            class="inline-flex items-center gap-2 rounded-full px-6 py-2.5 text-sm font-semibold text-white transition-all duration-300 hover:scale-[1.03]"
            style="background: linear-gradient(135deg, #2563eb, #1d4ed8); box-shadow: 0 4px 24px rgba(37,99,235,0.45), inset 0 1px 0 rgba(255,255,255,0.15);"
          >
            <ArrowUpRight client:visible size={14} strokeWidth={2.2} /> Message on WhatsApp
          </a>
          <a
            href="/contact"
            class="inline-flex items-center gap-2 rounded-full px-6 py-2.5 text-sm font-medium text-slate-300 glass-panel ring-hover transition-all duration-300 hover:text-white"
          >
            Open Contact Page <ArrowRight client:visible size={14} strokeWidth={2.2} />
          </a>
        </div>
      </div>

      <!-- Right: animated trading graph -->
      <div class="absolute right-0 top-0 bottom-0 pointer-events-none"
        style="width: 100%; min-width: 220px;
          mask-image: linear-gradient(90deg, transparent 0%, black 30%, black 100%),
                      linear-gradient(0deg, black 0%, black 80%, transparent 100%);
          -webkit-mask-image: linear-gradient(90deg, transparent 0%, black 30%, black 100%),
                      linear-gradient(0deg, black 0%, black 80%, transparent 100%);
          mask-composite: intersect;
          -webkit-mask-composite: source-in;">
        <canvas id="cta-graph-canvas" style="width:100%; height:100%; display:block;"></canvas>
      </div>

    </div>
  </div>
</section>


<script is:inline data-astro-rerun>
(() => {
  if (window.__ctaGraphCleanup) window.__ctaGraphCleanup();

  const canvas = document.getElementById('cta-graph-canvas');
  if (!canvas) return;

  let rafId = null;
  let observer = null;

  function resize() {
    canvas.width  = canvas.offsetWidth  * window.devicePixelRatio;
    canvas.height = canvas.offsetHeight * window.devicePixelRatio;
  }
  resize();
  window.addEventListener('resize', resize, { passive: true });

  const ctx = canvas.getContext('2d');

  // Bar data â€” heights as fractions 0..1, will animate upward
  const BARS = [
    { target: 0.22, delay: 0    },
    { target: 0.30, delay: 0.08 },
    { target: 0.26, delay: 0.16 },
    { target: 0.42, delay: 0.24 },
    { target: 0.38, delay: 0.32 },
    { target: 0.55, delay: 0.40 },
    { target: 0.50, delay: 0.48 },
    { target: 0.68, delay: 0.56 },
    { target: 0.62, delay: 0.64 },
    { target: 0.80, delay: 0.72 },
    { target: 0.75, delay: 0.80 },
    { target: 0.92, delay: 0.88 },
  ];

  const TOTAL_DURATION = 3800; // ms â€” slow rise
  const LOOP_PAUSE     = 1800; // ms pause at top before resetting
  let startTime = null;
  let phase = 'rise'; // rise | pause | reset
  let phaseStart = null;

  // current animated heights
  const current = BARS.map(() => 0);

  function easeOutQuart(t) {
    return 1 - Math.pow(1 - t, 4);
  }

  let ctaLastFrame = 0;
  function drawFrame(now) {
    if (!startTime) { startTime = now; phaseStart = now; }
    const ctaDelta = now - ctaLastFrame;
    if (ctaDelta < 14 && ctaLastFrame !== 0) {
      rafId = requestAnimationFrame(drawFrame);
      return;
    }
    ctaLastFrame = now;

    const W = canvas.width;
    const H = canvas.height;
    ctx.clearRect(0, 0, W, H);

    const elapsed = now - phaseStart;

    if (phase === 'rise') {
      const progress = Math.min(elapsed / TOTAL_DURATION, 1);

      BARS.forEach((bar, i) => {
        const barProgress = Math.max(0, Math.min(
          (progress - bar.delay * 0.5) / (1 - bar.delay * 0.5), 1
        ));
        current[i] = easeOutQuart(barProgress) * bar.target;
      });

      if (progress >= 1) { phase = 'pause'; phaseStart = now; }

    } else if (phase === 'pause') {
      if (elapsed >= LOOP_PAUSE) { phase = 'rise'; phaseStart = now; current.fill(0); }

    } else if (phase === 'reset') {
      phase = 'rise'; phaseStart = now; current.fill(0);
    }

    // Layout
    const barCount  = BARS.length;
    const gap       = W * 0.022;
    const barW      = (W - gap * (barCount + 1)) / barCount;
    const floorY    = H * 0.90;
    const maxBarH   = H * 0.68;

    // Draw bars
    BARS.forEach((bar, i) => {
      const x    = gap + i * (barW + gap);
      const barH = current[i] * maxBarH;
      const y    = floorY - barH;

      // Bar gradient â€” dark blue at bottom, bright blue-white at top
      const grad = ctx.createLinearGradient(x, y, x, floorY);
      grad.addColorStop(0,   'rgba(147,197,253,0.95)');
      grad.addColorStop(0.3, 'rgba(59,130,246,0.85)');
      grad.addColorStop(1,   'rgba(29,78,216,0.30)');

      ctx.save();
      ctx.shadowColor = 'rgba(96,165,250,0.70)';
      ctx.shadowBlur  = 8 * window.devicePixelRatio;

      // Rounded top corners
      const r = Math.min(barW * 0.3, 5 * window.devicePixelRatio);
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.lineTo(x + barW - r, y);
      ctx.quadraticCurveTo(x + barW, y, x + barW, y + r);
      ctx.lineTo(x + barW, floorY);
      ctx.lineTo(x, floorY);
      ctx.lineTo(x, y + r);
      ctx.quadraticCurveTo(x, y, x + r, y);
      ctx.closePath();
      ctx.fillStyle = grad;
      ctx.fill();

      // Top cap glow highlight
      if (barH > 4) {
        const capGrad = ctx.createLinearGradient(x, y, x + barW, y);
        capGrad.addColorStop(0, 'rgba(255,255,255,0)');
        capGrad.addColorStop(0.5, 'rgba(255,255,255,0.55)');
        capGrad.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.fillStyle = capGrad;
        ctx.fillRect(x, y, barW, Math.min(3 * window.devicePixelRatio, barH));
      }

      ctx.restore();
    });

    // Draw line chart over bars â€” connects bar tops
    ctx.save();
    ctx.shadowColor = 'rgba(200,230,255,0.90)';
    ctx.shadowBlur  = 10 * window.devicePixelRatio;
    ctx.strokeStyle = 'rgba(200,228,255,0.85)';
    ctx.lineWidth   = 1.4 * window.devicePixelRatio;
    ctx.lineJoin    = 'round';
    ctx.lineCap     = 'round';

    ctx.beginPath();
    BARS.forEach((bar, i) => {
      const x    = gap + i * (barW + gap) + barW / 2;
      const barH = current[i] * maxBarH;
      const y    = floorY - barH;
      if (i === 0) ctx.moveTo(x, y);
      else         ctx.lineTo(x, y);
    });
    ctx.stroke();
    ctx.restore();

    // Glowing dot at the latest (rightmost) bar top
    const lastI  = BARS.length - 1;
    const dotX   = gap + lastI * (barW + gap) + barW / 2;
    const dotY   = floorY - current[lastI] * maxBarH;
    if (current[lastI] > 0.01) {
      ctx.save();
      const dotGrad = ctx.createRadialGradient(dotX, dotY, 0, dotX, dotY, 7 * window.devicePixelRatio);
      dotGrad.addColorStop(0, 'rgba(255,255,255,1)');
      dotGrad.addColorStop(0.3, 'rgba(147,197,253,0.9)');
      dotGrad.addColorStop(1, 'rgba(37,99,235,0)');
      ctx.fillStyle = dotGrad;
      ctx.beginPath();
      ctx.arc(dotX, dotY, 7 * window.devicePixelRatio, 0, Math.PI * 2);
      ctx.fill();
      // Inner solid dot
      ctx.fillStyle = '#ffffff';
      ctx.beginPath();
      ctx.arc(dotX, dotY, 2 * window.devicePixelRatio, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    // Floor line
    ctx.save();
    const floorGrad = ctx.createLinearGradient(0, floorY, W, floorY);
    floorGrad.addColorStop(0, 'rgba(147,197,253,0)');
    floorGrad.addColorStop(0.3, 'rgba(147,197,253,0.25)');
    floorGrad.addColorStop(1, 'rgba(147,197,253,0.05)');
    ctx.strokeStyle = floorGrad;
    ctx.lineWidth = 1 * window.devicePixelRatio;
    ctx.beginPath();
    ctx.moveTo(0, floorY);
    ctx.lineTo(W, floorY);
    ctx.stroke();
    ctx.restore();

    rafId = requestAnimationFrame(drawFrame);
  }

  // Start when section enters viewport
  const ctaSection = canvas.closest('section');
  observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        startTime = null;
        phaseStart = null;
        phase = 'rise';
        current.fill(0);
        rafId = requestAnimationFrame(drawFrame);
        observer.unobserve(ctaSection);
      }
    });
  }, { threshold: 0.3 });
  if (ctaSection) observer.observe(ctaSection);
  else rafId = requestAnimationFrame(drawFrame);

  window.__ctaGraphCleanup = () => {
    if (observer) observer.disconnect();
    if (rafId) cancelAnimationFrame(rafId);
    window.removeEventListener('resize', resize);
  };

})();
</script>

<script is:inline data-astro-rerun>
  (() => {
    if (window.__scheduleWrite) return;

    // ── BATCHED DOM WRITE QUEUE ─────────────────────────
    // Groups all style mutations into a single rAF write frame
    // Prevents layout thrashing (read → write → read → write)
    const _writeQ = [];
    let _rafScheduled = false;

    window.__scheduleWrite = (fn) => {
      _writeQ.push(fn);
      if (!_rafScheduled) {
        _rafScheduled = true;
        requestAnimationFrame(() => {
          _rafScheduled = false;
          // All writes happen in ONE frame — zero layout thrashing
          const batch = _writeQ.splice(0);
          batch.forEach(f => f());
        });
      }
    };
  })();
</script>

<script is:inline data-astro-rerun>
  (() => {
    const capCards = document.querySelectorAll('.cap-card');
    if (!capCards.length) return;

    let hasAnimatedIn = false;
    const scheduleWrite = window.__scheduleWrite || ((fn) => fn());

    const obs = new IntersectionObserver((entries) => {
      const toProcess = entries.map(entry => ({
        el: entry.target,
        visible: entry.isIntersecting,
      }));

      scheduleWrite(() => {
        toProcess.forEach(({ el, visible }) => {
          if (visible) {
            hasAnimatedIn = true;
            const idx = parseInt(el.dataset.capIndex || '0', 10);
            const delay = isNaN(idx) ? 0 : Math.min(idx * 60, 300);
            setTimeout(() => {
              el.classList.remove('cap-out');
              el.classList.add('cap-in');
            }, delay);
          } else if (hasAnimatedIn) {
            el.classList.remove('cap-in');
            el.classList.add('cap-out');
          }
        });
      });
    }, {
      threshold: 0.18,
      rootMargin: '0px 0px -60px 0px'
    });

    capCards.forEach(card => obs.observe(card));
  })();
</script>

<script is:inline data-astro-rerun>
  (() => {
    if (window.__capMediaCleanup) window.__capMediaCleanup();

    const videos = Array.from(document.querySelectorAll('.cap-media-video'));
    if (!videos.length) return;

    const isMobile = window.matchMedia('(max-width: 767px)').matches;
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const ratios = new Map();
    const targets = videos.map((video) => ({
      video,
      target: video.closest('.cap-card') || video,
    }));
    const targetToVideo = new Map(targets.map(({ target, video }) => [target, video]));

    videos.forEach((video) => {
      video.autoplay = true;
      video.muted = true;
      video.defaultMuted = true;
      video.playsInline = true;
      video.preload = 'metadata';
      video.setAttribute('autoplay', '');
      video.setAttribute('muted', '');
      video.setAttribute('playsinline', '');
      video.setAttribute('webkit-playsinline', '');
      video.setAttribute('disablePictureInPicture', '');
      video.preload = 'none';
      ratios.set(video, 0);
    });

    if (prefersReducedMotion) {
      videos.forEach((video) => video.pause());
      return;
    }

    function loadVideo(video) {
      if (video.dataset.loaded === 'true') return;
      const src = video.dataset.src;
      if (!src) return;
      video.preload = 'auto';
      video.src = src;
      video.dataset.loaded = 'true';
      video.load();
    }

    function unloadVideo(video) {
      if (video.dataset.loaded !== 'true') return;
      video.pause();
      video.removeAttribute('src');
      video.load();
      delete video.dataset.loaded;
    }

    function tryPlay(video) {
      loadVideo(video);
      const attempt = () => {
        const playPromise = video.play();
        if (playPromise && typeof playPromise.catch === 'function') {
          playPromise.catch(() => {});
        }
      };

      if (video.readyState >= 2) {
        attempt();
        return;
      }

      const onReady = () => {
        attempt();
      };

      video.addEventListener('loadeddata', onReady, { once: true });
      video.addEventListener('canplay', onReady, { once: true });
    }

    function syncPlayback() {
      if (isMobile) {
        let activeVideo = null;
        let bestRatio = 0;

        videos.forEach((video) => {
          const ratio = ratios.get(video) || 0;
          if (ratio > 0.08 && ratio >= bestRatio) {
            bestRatio = ratio;
            activeVideo = video;
          }
        });

        videos.forEach((video) => {
          if (video === activeVideo) {
            tryPlay(video);
          } else {
            unloadVideo(video);
          }
        });
        return;
      }

      videos.forEach((video) => {
        const ratio = ratios.get(video) || 0;
        if (ratio > 0.12) {
          tryPlay(video);
        } else {
          video.pause();
        }
      });
    }

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        const video = targetToVideo.get(entry.target);
        if (!video) return;
        ratios.set(video, entry.isIntersecting ? entry.intersectionRatio : 0);
      });
      syncPlayback();
    }, {
      threshold: [0, 0.08, 0.18, 0.35, 0.6, 0.85],
      rootMargin: '120px 0px 120px 0px'
    });

    targets.forEach(({ target }) => {
      observer.observe(target);
    });

    window.__capMediaCleanup = () => {
      observer.disconnect();
      videos.forEach((video) => {
        video.pause();
        if (isMobile) unloadVideo(video);
      });
    };
  })();
</script>

<script is:inline data-astro-rerun>
  (() => {
    // Metric cards with counter reset
    const scheduleWrite = window.__scheduleWrite || ((fn) => fn());
    document.querySelectorAll('.metric-drop, .metric-slide-left, .metric-rise, .metric-slide-right').forEach(card => {
      let seen = false;
      const inClass = 'metric-in';
      const outClass = 'metric-out';

      const obs = new IntersectionObserver((entries) => {
        const toProcess = entries.map(entry => ({
          visible: entry.isIntersecting,
        }));

        scheduleWrite(() => {
          toProcess.forEach(({ visible }) => {
            if (visible) {
              seen = true;
              const idx = parseInt(card.dataset.metric || '0', 10);
              const delay = isNaN(idx) ? 0 : Math.min(idx * 60, 300);
              setTimeout(() => {
                card.classList.remove(outClass);
                card.classList.add(inClass);
              }, delay);

              // Reset and restart counter inside this card
              const counter = card.querySelector('[data-counter-root]');
              if (counter) {
                // Dispatch custom event to restart the count
                counter.dispatchEvent(new CustomEvent('restart-counter', { bubbles: false }));
              }

              // Fallback: find the span and trigger intersection re-check
              // by briefly hiding and re-showing via a class toggle
              const span = card.querySelector('span');
              if (span) {
                const resetObs = new IntersectionObserver((e) => {
                  if (e[0].isIntersecting) {
                    // Already handled by AnimatedCounter's own observer
                  }
                  resetObs.disconnect();
                }, { threshold: 0.1 });
                resetObs.observe(span);
              }
            } else if (seen) {
              card.classList.remove(inClass);
              card.classList.add(outClass);

            }
          });
        });
      }, { threshold: 0.35, rootMargin: '0px 0px -100px 0px' });

      obs.observe(card);
    });
  })();
</script>

<script is:inline data-astro-rerun>
(() => {
  if (window.__testiRowsCleanup) window.__testiRowsCleanup();

  /* ── Seed data ── */
  const SEED = [
    { quote: "Execution quality improved quickly once the funnel, creatives, and reporting were aligned under one operating rhythm.", name: "Placeholder Client",     role: "Commercial Director",  company: "Regional Services Group",  photo: null },
    { quote: "Campaign decisions became easier because tracking and lead-quality signals were finally consistent across teams.",    name: "Placeholder Stakeholder", role: "Marketing Head",       company: "Growth Portfolio",          photo: null },
    { quote: "The Meta campaigns went from guesswork to a repeatable system within the first month. CPL dropped by over 30%.",     name: "Nour Al Rashid",          role: "Head of Growth",       company: "Dubai Realty Group",         photo: null },
    { quote: "Our content pipeline was chaos before this. Now we have a weekly cadence, clear briefs, and measurable reach.",      name: "Sara Khalid",             role: "Brand Manager",        company: "UAE Lifestyle Co.",          photo: null },
    { quote: "He delivered the WordPress plugin system in two weeks. It handles lead intake, scoring, and routing automatically.", name: "Omar Faris",              role: "CTO",                  company: "PropTech Ventures",          photo: null },
    { quote: "Working across three brands simultaneously, he kept every campaign aligned and reporting clean. Rare operational skill.", name: "Layla Al Mansoori",  role: "VP Marketing",         company: "Al Noor Holdings",           photo: null },
    { quote: "The tracking setup gave us visibility we never had. Decision speed improved dramatically within weeks.",             name: "Khalid Hassan",           role: "Performance Lead",     company: "Growth Studio Dubai",        photo: null },
    { quote: "Creative briefs, content calendar, and ad copy all integrated into one system. Saved us 12 hours a week.",          name: "Reem Al Farsi",           role: "Head of Content",      company: "MENA Media Group",           photo: null },
    { quote: "Funnel architecture was rebuilt from scratch. Lead quality improved by 40% in the first campaign cycle.",           name: "Faisal Al Tamimi",        role: "Digital Director",     company: "Apex Real Estate",           photo: null },
  ];

  function getInitial(name) { return name ? name.charAt(0).toUpperCase() : '?'; }

  function getUserTestis() {
    try { return JSON.parse(localStorage.getItem('user_testimonials_v2') || '[]'); } catch { return []; }
  }
  function saveUserTestis(arr) {
    try { localStorage.setItem('user_testimonials_v2', JSON.stringify(arr)); } catch {}
  }

  function buildCard(t, isNew) {
    const div = document.createElement('div');
    div.className = 'testi-card-v2' + (isNew ? ' testi-new-v2' : '');

    const avatarHTML = t.photo
      ? `<img src="${t.photo}" alt="${t.name}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;border:1px solid rgba(147,197,253,0.25);flex-shrink:0;" />`
      : `<div style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.85rem;font-weight:700;color:#fff;flex-shrink:0;background:linear-gradient(135deg,rgba(37,99,235,0.7),rgba(147,197,253,0.4));border:1px solid rgba(147,197,253,0.20);">${getInitial(t.name)}</div>`;

    div.innerHTML = `
      <div style="font-size:1.6rem;color:rgba(147,197,253,0.18);line-height:1;margin-bottom:0.7rem;user-select:none;">&ldquo;</div>
      <p style="font-size:0.82rem;color:#cbd5e1;line-height:1.65;font-style:italic;margin-bottom:1.1rem;">${t.quote}</p>
      <div style="display:flex;align-items:center;gap:0.65rem;">
        ${avatarHTML}
        <div>
          <p style="font-size:0.8rem;font-weight:600;color:#f1f5f9;">${t.name}</p>
          <p style="font-size:0.7rem;color:#64748b;">${t.role} &middot; ${t.company}</p>
        </div>
      </div>`;
    return div;
  }

  /* ── Split into 3 rows ── */
  function distributeToRows(all) {
    const rows = [[], [], []];
    all.forEach((t, i) => rows[i % 3].push(t));
    return rows;
  }

  function populateRows() {
    const all = [...SEED, ...getUserTestis()];
    const [r1, r2, r3] = distributeToRows(all);
    const rowData = [
      { id: 'testi-row-1', items: r1 },
      { id: 'testi-row-2', items: r2 },
      { id: 'testi-row-3', items: r3 },
    ];
    rowData.forEach(({ id, items }) => {
      const row = document.getElementById(id);
      if (!row) return;
      row.innerHTML = '';
      // Triple for seamless infinite loop
      [...items, ...items, ...items].forEach(t => row.appendChild(buildCard(t, false)));
    });
  }

  /* ── Parallax + auto-scroll ── */
  const rows = [];
  let lastScrollY = window.scrollY;
  let animFrame = null;

  function initRows() {
    rows.length = 0;
    ['testi-row-1', 'testi-row-2', 'testi-row-3'].forEach((id, i) => {
      const el = document.getElementById(id);
      if (!el) return;
      const direction = i % 2 === 0 ? 1 : -1;
      const cardW = 314; // card width + gap
      const singleW = el.children.length / 3 * cardW;
      rows.push({ el, direction, x: i % 2 === 0 ? 0 : -singleW, singleW, speed: 0.28 + i * 0.06 });
    });
  }

  function tick() {
    const currentScrollY = window.scrollY;
    const scrollDelta = currentScrollY - lastScrollY;
    lastScrollY = currentScrollY;

    // Check if in viewport
    const section = document.getElementById('testi-section');
    if (section) {
      const rect = section.getBoundingClientRect();
      rows.forEach(row => {
        // Auto-scroll: slow constant drift
        row.x += row.direction * row.speed;
        // Scroll parallax: extra push based on scroll direction
        row.x += row.direction * scrollDelta * 0.4;

        // Seamless loop
        if (row.direction > 0 && row.x > 0) row.x -= row.singleW;
        if (row.direction < 0 && row.x < -row.singleW * 2) row.x += row.singleW;

        row.el.style.transform = `translateX(${row.x}px) translateZ(0)`;
      });
    }

    animFrame = requestAnimationFrame(tick);
  }

  /* ── Modal logic ── */
  let uploadedPhotoData = null;

  function openModal() {
    const m = document.getElementById('testi-modal');
    if (m) { m.style.display = 'flex'; }
  }
  function closeModal() {
    const m = document.getElementById('testi-modal');
    if (m) m.style.display = 'none';
    uploadedPhotoData = null;
    const preview = document.getElementById('testi-avatar-preview');
    if (preview) { preview.innerHTML = '?'; preview.style.backgroundImage = ''; }
    const s = document.getElementById('testi-success');
    if (s) s.style.display = 'none';
    ['testi-name','testi-role','testi-quote'].forEach(id => {
      const el = document.getElementById(id);
      if (el) { el.value = ''; el.style.borderColor = ''; }
    });
    const submitBtn = document.getElementById('testi-submit-btn');
    if (submitBtn) { submitBtn.textContent = 'Submit testimonial'; submitBtn.style.background = 'linear-gradient(135deg,#2563eb,#1d4ed8)'; }
  }

  function addNewCard(t) {
    const userT = getUserTestis();
    userT.push(t);
    saveUserTestis(userT);

    // Add to the shortest row
    const rowEls = ['testi-row-1','testi-row-2','testi-row-3'].map(id => document.getElementById(id));
    const shortest = rowEls.reduce((a, b) => (a && b && a.children.length <= b.children.length ? a : b));
    if (shortest) {
      const card = buildCard(t, true);
      shortest.appendChild(buildCard(t, false)); // second copy for loop
      shortest.insertBefore(card, shortest.firstChild);
    }

    // Update singleW for all rows
    rows.forEach(row => {
      const cardW = 314;
      row.singleW = Math.floor(row.el.children.length / 3) * cardW;
    });
  }

  /* ── Photo upload handler ── */
  function initPhotoUpload() {
    const input = document.getElementById('testi-photo-input');
    const preview = document.getElementById('testi-avatar-preview');
    const nameInput = document.getElementById('testi-name');

    if (input) {
      input.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          uploadedPhotoData = ev.target.result;
          if (preview) {
            preview.innerHTML = '';
            preview.style.cssText += `background-image:url(${uploadedPhotoData});background-size:cover;background-position:center;`;
          }
        };
        reader.readAsDataURL(file);
      });
    }

    // Update initial letter in preview when name typed
    if (nameInput && preview) {
      nameInput.addEventListener('input', () => {
        if (!uploadedPhotoData) {
          preview.innerHTML = getInitial(nameInput.value) || '?';
        }
      });
    }
  }

  function initTestimonials() {
    populateRows();
    initRows();
    animFrame = requestAnimationFrame(tick);
    initPhotoUpload();

    const openBtn   = document.getElementById('testi-open-btn');
    const closeBtn  = document.getElementById('testi-close-btn');
    const cancelBtn = document.getElementById('testi-cancel-btn');
    const submitBtn = document.getElementById('testi-submit-btn');
    const modal     = document.getElementById('testi-modal');

    if (openBtn) openBtn.onclick = openModal;
    if (closeBtn) closeBtn.onclick = closeModal;
    if (cancelBtn) cancelBtn.onclick = closeModal;
    if (modal) modal.onclick = (e) => { if (e.target === modal) closeModal(); };

    if (submitBtn) {
      submitBtn.onclick = () => {
        const name  = document.getElementById('testi-name')?.value.trim();
        const role  = document.getElementById('testi-role')?.value.trim();
        const quote = document.getElementById('testi-quote')?.value.trim();

        const nameEl  = document.getElementById('testi-name');
        const quoteEl = document.getElementById('testi-quote');
        if (!name)  { if (nameEl)  nameEl.style.borderColor  = 'rgba(239,68,68,0.6)'; }
        if (!quote) { if (quoteEl) quoteEl.style.borderColor = 'rgba(239,68,68,0.6)'; }
        if (!name || !quote) return;

        const parts = role ? role.split('·') : ['', ''];
        const t = {
          quote,
          name,
          role: (parts[0] || role || 'Client').trim(),
          company: (parts[1] || 'UAE').trim(),
          photo: uploadedPhotoData || null,
        };

        addNewCard(t);

        const success = document.getElementById('testi-success');
        if (success) success.style.display = 'block';
        submitBtn.textContent = '✓ Added';
        submitBtn.style.background = 'linear-gradient(135deg,#16a34a,#15803d)';
        setTimeout(closeModal, 1800);
      };
    }
  }

  initTestimonials();

  window.__testiRowsCleanup = () => {
    if (animFrame) cancelAnimationFrame(animFrame);
  };

})();
</script>

<script is:inline data-astro-rerun>
  (() => {
    const CARDS = [
      '.work-left',
      '.work-card-1',
      '.work-card-2',
      '.work-card-3',
      '.work-card-center',
      '.work-card-4'
    ];

    // Observe EACH card individually so in/out fires per card
    const allCards = document.querySelectorAll(
      '.work-left, .work-card-1, .work-card-2, .work-card-3, .work-card-center, .work-card-4'
    );
    if (!allCards.length) return;

    // Track which cards have ever been seen
    const seen = new Set();
    const scheduleWrite = window.__scheduleWrite || ((fn) => fn());

    const obs = new IntersectionObserver((entries) => {
      const toProcess = entries.map(entry => ({
        el: entry.target,
        visible: entry.isIntersecting,
      }));

      scheduleWrite(() => {
        toProcess.forEach(({ el, visible }) => {
          if (visible) {
            seen.add(el);
            // Small delay so user sees the fly-in
            const delay = seen.size === 1 ? 120 : 60;
            setTimeout(() => {
              el.classList.remove('work-out');
              el.classList.add('work-in');
            }, delay);
          } else if (seen.has(el)) {
            // Card has been seen before — trigger out animation
            setTimeout(() => {
              el.classList.remove('work-in');
              el.classList.add('work-out');
            }, 40);
          }
        });
      });
    }, {
      // Lower threshold so card must be well inside viewport before IN fires
      threshold: [0, 0.25, 0.5],
      // Negative bottom margin pushes trigger line UP â€” card must scroll
      // further into view before animating in
      rootMargin: '0px 0px -180px 0px'
    });

    allCards.forEach(card => obs.observe(card));
  })();
</script></BaseLayout>
<style>

  /* ------------------------------------------------
     TICKER ï¿½ 3 ROWS, EACH A CONTINUOUS LOOP
  ------------------------------------------------ */

  /* Outer wrapper clips overflow */
  .ticker-row-wrap {
    overflow: hidden;
    width: 100%;
  }

  /* Row: single flex line, no wrapping ï¿½ CRITICAL */
  .ticker-row {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    align-items: center;
    width: max-content;
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }

  /* Each row at a different speed */
  .row-1 { animation: marqueeLeft 42s linear infinite; }
  .row-2 { animation: marqueeLeft 64s linear infinite; }
  .row-3 { animation: marqueeLeft 50s linear infinite; }

  /* Pause row on hover */
  .ticker-row-wrap:hover .ticker-row {
    animation-play-state: paused;
  }

  /* Seamless loop keyframe
     -25% = one copy of the list (4 copies total, so 1/4 = 25%)
     When it snaps from -25% back to 0 the content is identical ï¿½ invisible jump */
  @keyframes marqueeLeft {
    0%   { transform: translateX(0); }
    100% { transform: translateX(-25%); }
  }


  /* ------------------------------------------------
     TICKER ITEM
  ------------------------------------------------ */

  .ticker-item {
    /* Stays on one line ï¿½ CRITICAL */
    display: inline-flex;
    flex-shrink: 0;
    white-space: nowrap;
    align-items: center;
    gap: 8px;
    padding: 0 26px;

    font-family: "DM Mono", ui-monospace, monospace;
    font-size: 0.62rem;
    letter-spacing: 0.20em;
    text-transform: uppercase;
    color: rgba(92, 107, 128, 0.85);

    /* Glow animation ï¿½ delay set per item via CSS var */
    animation: itemGlow 9s ease-in-out infinite;
    animation-delay: var(--glow-delay, 0s);
    animation-fill-mode: both;

    transition: color 0.25s ease;
  }

  /* Hover: override animation, go bright white */
  .ticker-item:hover {
    color: rgba(224, 237, 248, 0.95);
    animation: none;
    text-shadow: none;
  }


  /* ------------------------------------------------
     DOT ?
  ------------------------------------------------ */

  .ticker-dot {
    font-size: 0.55rem;
    flex-shrink: 0;
    color: rgba(147, 197, 253, 0.20);

    animation: dotGlow 9s ease-in-out infinite;
    animation-delay: var(--glow-delay, 0s);
    animation-fill-mode: both;

    transition: color 0.25s ease, text-shadow 0.25s ease;
  }

  /* Hover: dot also goes bright */
  .ticker-item:hover .ticker-dot {
    color: rgba(147, 197, 253, 0.95);
    text-shadow: 0 0 8px rgba(147, 197, 253, 0.75);
    animation: none;
  }


  /* ------------------------------------------------
     GLOW KEYFRAMES
  ------------------------------------------------ */

  /* Item text: dim ? bright blue flash ? dim */
  @keyframes itemGlow {
    0%   { color: rgba(92, 107, 128, 0.85); text-shadow: none; }
    36%  { color: rgba(92, 107, 128, 0.85); text-shadow: none; }

    /* Flash on */
    43%  {
      color: rgba(147, 197, 253, 1.0);
      text-shadow:
        0 0 10px rgba(147, 197, 253, 0.55),
        0 0 24px rgba(37, 99, 235, 0.30);
    }
    53%  {
      color: rgba(147, 197, 253, 1.0);
      text-shadow:
        0 0 10px rgba(147, 197, 253, 0.55),
        0 0 24px rgba(37, 99, 235, 0.30);
    }

    /* Fade off */
    63%  { color: rgba(92, 107, 128, 0.85); text-shadow: none; }
    100% { color: rgba(92, 107, 128, 0.85); text-shadow: none; }
  }

  /* Dot: same timing, more intense glow */
  @keyframes dotGlow {
    0%   { color: rgba(147, 197, 253, 0.20); text-shadow: none; }
    36%  { color: rgba(147, 197, 253, 0.20); text-shadow: none; }

    43%  {
      color: rgba(147, 197, 253, 1.0);
      text-shadow:
        0 0 6px rgba(147, 197, 253, 0.90),
        0 0 18px rgba(37, 99, 235, 0.65);
    }
    53%  {
      color: rgba(147, 197, 253, 1.0);
      text-shadow:
        0 0 6px rgba(147, 197, 253, 0.90),
        0 0 18px rgba(37, 99, 235, 0.65);
    }

    63%  { color: rgba(147, 197, 253, 0.20); text-shadow: none; }
    100% { color: rgba(147, 197, 253, 0.20); text-shadow: none; }
  }


  /* ------------------------------------------------
     REDUCED MOTION
  ------------------------------------------------ */

  @media (prefers-reduced-motion: reduce) {
    .ticker-row  { animation: none !important; }
    .ticker-item { animation: none !important; }
    .ticker-dot  { animation: none !important; }
  }

  /* Contact pill glow (segmented control) */
  .contact-pill:hover,
  .contact-pill:focus-visible {
    color: #f0fff4;
    background: rgba(34,197,94,0.18);
    box-shadow:
      0 0 0 1px rgba(34,197,94,0.45),
      0 0 18px rgba(34,197,94,0.55),
      0 0 36px rgba(34,197,94,0.35);
  }
  .contact-pill:active {
    box-shadow:
      0 0 0 1px rgba(34,197,94,0.55),
      0 0 12px rgba(34,197,94,0.45);
    transform: scale(0.99);
  }

  /* -- METRICS CARDS -- 4 unique entrance animations -- */

  .metric-card {
    opacity: 0;
    transition-timing-function: cubic-bezier(0.22, 1, 0.36, 1);
  }

  .metric-drop {
    transform: translateY(-40px) rotateX(25deg);
    transition: opacity 1.4s cubic-bezier(0.22,1,0.36,1), transform 1.4s cubic-bezier(0.34,1.4,0.64,1), filter 1.0s ease;
    transform-origin: top center;
  }
  .metric-drop.metric-in {
    opacity: 1;
    transform: translateY(0) rotateX(0deg);
  }

  .metric-slide-left {
    transform: translateX(-50px) scale(0.92);
    transition: opacity 1.3s cubic-bezier(0.22,1,0.36,1) 0.12s, transform 1.3s cubic-bezier(0.22,1,0.36,1) 0.12s;
  }
  .metric-slide-left.metric-in {
    opacity: 1;
    transform: translateX(0) scale(1);
  }

  .metric-rise {
    transform: translateY(40px);
    filter: blur(4px);
    transition: opacity 1.4s cubic-bezier(0.22,1,0.36,1) 0.22s, transform 1.4s cubic-bezier(0.22,1,0.36,1) 0.22s, filter 1.1s ease 0.22s;
  }
  .metric-rise.metric-in {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0px);
  }

  .metric-slide-right {
    transform: translateX(50px) rotateY(15deg);
    transition: opacity 1.3s cubic-bezier(0.22,1,0.36,1) 0.32s, transform 1.3s cubic-bezier(0.22,1,0.36,1) 0.32s;
    transform-origin: right center;
  }
  .metric-slide-right.metric-in {
    opacity: 1;
    transform: translateX(0) rotateY(0deg);
  }

  /* -- METRIC CARDS OUT -- */
  .metric-drop.metric-out {
    opacity: 0;
    transform: translateY(-50px) rotateX(35deg) scale(0.9);
    filter: blur(3px);
    transition: opacity 0.85s ease, transform 0.85s ease, filter 0.65s ease;
  }
  .metric-slide-left.metric-out {
    opacity: 0;
    transform: translateX(-40px) scale(0.93);
    filter: blur(2px);
    transition: opacity 0.80s ease 0.06s, transform 0.80s ease 0.06s, filter 0.60s ease 0.06s;
  }
  .metric-rise.metric-out {
    opacity: 0;
    transform: translateY(45px);
    filter: blur(4px);
    transition: opacity 0.85s ease 0.10s, transform 0.85s ease 0.10s, filter 0.65s ease 0.10s;
  }
  .metric-slide-right.metric-out {
    opacity: 0;
    transform: translateX(40px) rotateY(10deg);
    filter: blur(2px);
    transition: opacity 0.80s ease 0.14s, transform 0.80s ease 0.14s, filter 0.60s ease 0.14s;
  }

  .metric-card:hover {
    transform: translateY(-4px) !important;
    transition: transform 0.3s ease !important;
  }
  .metric-card:hover p:first-child {
    text-shadow: 0 0 30px rgba(147,197,253,0.5), 0 0 60px rgba(37,99,235,0.25);
  }

  /* CAPABILITIES -- 6 UNIQUE 3D CARD ANIMATIONS */

  .cap-card {
    opacity: 0;
    will-change: transform, opacity, filter;
  }

  .cap-card-0 {
    transform: translateY(-120px) rotateX(60deg) scale(0.8);
    filter: blur(3px);
    transition:
      opacity 1.4s cubic-bezier(0.22,1,0.36,1),
      transform 1.4s cubic-bezier(0.34,1.56,0.64,1),
      filter 1.0s ease;
    transform-origin: top center;
    transform-style: preserve-3d;
  }
  .cap-card-0.cap-in {
    opacity: 1;
    transform: translateY(0) rotateX(0deg) scale(1);
    filter: blur(0);
  }

  .cap-card-1 {
    transform: translateX(80px) rotateY(-90deg) scale(0.85);
    filter: blur(4px);
    transition:
      opacity 1.4s cubic-bezier(0.22,1,0.36,1) 0.14s,
      transform 1.4s cubic-bezier(0.22,1,0.36,1) 0.14s,
      filter 1.0s ease 0.14s;
    transform-origin: left center;
    transform-style: preserve-3d;
  }
  .cap-card-1.cap-in {
    opacity: 1;
    transform: translateX(0) rotateY(0deg) scale(1);
    filter: blur(0);
  }

  .cap-card-2 {
    transform: scale(0.3) rotate(-12deg);
    filter: blur(8px) brightness(2);
    transition:
      opacity 1.5s cubic-bezier(0.22,1,0.36,1) 0.24s,
      transform 1.5s cubic-bezier(0.34,1.4,0.64,1) 0.24s,
      filter 1.1s ease 0.24s;
    transform-origin: center center;
  }
  .cap-card-2.cap-in {
    opacity: 1;
    transform: scale(1) rotate(0deg);
    filter: blur(0) brightness(1);
  }

  .cap-card-3 {
    transform: translateY(100px) rotateX(-50deg) scale(0.9);
    filter: blur(5px);
    transition:
      opacity 1.4s cubic-bezier(0.22,1,0.36,1) 0.18s,
      transform 1.4s cubic-bezier(0.22,1,0.36,1) 0.18s,
      filter 1.0s ease 0.18s;
    transform-origin: bottom center;
    transform-style: preserve-3d;
  }
  .cap-card-3.cap-in {
    opacity: 1;
    transform: translateY(0) rotateX(0deg) scale(1);
    filter: blur(0);
  }

  .cap-card-4 {
    transform: scale(1.35) rotate(8deg) skewX(-8deg);
    filter: blur(6px) saturate(2);
    transition:
      opacity 1.5s cubic-bezier(0.22,1,0.36,1) 0.30s,
      transform 1.5s cubic-bezier(0.34,1.3,0.64,1) 0.30s,
      filter 1.1s ease 0.30s;
  }
  .cap-card-4.cap-in {
    opacity: 1;
    transform: scale(1) rotate(0deg) skewX(0deg);
    filter: blur(0) saturate(1);
  }

  .cap-card-5 {
    transform: translateX(-80px) rotateY(90deg) scale(0.85);
    filter: blur(4px);
    transition:
      opacity 1.4s cubic-bezier(0.22,1,0.36,1) 0.36s,
      transform 1.4s cubic-bezier(0.22,1,0.36,1) 0.36s,
      filter 1.0s ease 0.36s;
    transform-origin: right center;
    transform-style: preserve-3d;
  }
  .cap-card-5.cap-in {
    opacity: 1;
    transform: translateX(0) rotateY(0deg) scale(1);
    filter: blur(0);
  }

  /* -- CAP CARDS OUT -- each exits opposite to how it entered -- */

  .cap-card-0.cap-out {
    opacity: 0;
    transform: translateY(-80px) rotateX(40deg) scale(0.88);
    filter: blur(3px);
    transition: opacity 0.90s ease, transform 0.90s ease, filter 0.70s ease;
  }

  .cap-card-1.cap-out {
    opacity: 0;
    transform: translateX(60px) rotateY(-60deg) scale(0.88);
    filter: blur(3px);
    transition: opacity 0.85s ease 0.06s, transform 0.85s ease 0.06s, filter 0.65s ease 0.06s;
  }

  .cap-card-2.cap-out {
    opacity: 0;
    transform: scale(0.4) rotate(8deg);
    filter: blur(6px) brightness(1.8);
    transition: opacity 0.90s ease 0.10s, transform 0.90s ease 0.10s, filter 0.70s ease 0.10s;
  }

  .cap-card-3.cap-out {
    opacity: 0;
    transform: translateY(70px) rotateX(-35deg) scale(0.91);
    filter: blur(3px);
    transition: opacity 0.88s ease 0.05s, transform 0.88s ease 0.05s, filter 0.68s ease 0.05s;
  }

  .cap-card-4.cap-out {
    opacity: 0;
    transform: scale(1.2) rotate(5deg) skewX(-5deg);
    filter: blur(5px) saturate(1.8);
    transition: opacity 0.90s ease 0.12s, transform 0.90s ease 0.12s, filter 0.70s ease 0.12s;
  }

  .cap-card-5.cap-out {
    opacity: 0;
    transform: translateX(-60px) rotateY(60deg) scale(0.88);
    filter: blur(3px);
    transition: opacity 0.85s ease 0.16s, transform 0.85s ease 0.16s, filter 0.65s ease 0.16s;
  }

  .cap-card.cap-out:hover { transform: none !important; }

  .cap-card-0:hover { transform: translateY(-6px) rotateX(4deg) !important; }
  .cap-card-1:hover { transform: translateY(-6px) rotateY(-4deg) !important; }
  .cap-card-2:hover { transform: translateY(-6px) rotate(1deg) scale(1.02) !important; }
  .cap-card-3:hover { transform: translateY(-6px) rotateX(-4deg) !important; }
  .cap-card-4:hover { transform: translateY(-6px) skewX(1deg) scale(1.02) !important; }
  .cap-card-5:hover { transform: translateY(-6px) rotateY(4deg) !important; }

  .cap-card {
    transition-property: transform, box-shadow;
    transition-duration: 0.3s;
    transition-timing-function: ease;
  }
  .cap-card:hover {
    box-shadow: 0 0 0 1px rgba(147,197,253,0.25),
                0 24px 60px rgba(0,0,0,0.5),
                0 0 40px rgba(37,99,235,0.12);
  }

  .cap-media-shell {
    position: relative;
    width: 100%;
  }

  .cap-media-top {
    margin-bottom: auto;
    padding-bottom: 1.1rem;
  }

  .cap-media-bottom {
    margin-top: auto;
    padding-top: 1.25rem;
  }

  .cap-media-frame {
    position: relative;
    overflow: hidden;
    border-radius: 1rem;
    min-height: 132px;
    border: 1px solid rgba(147,197,253,0.12);
    background:
      linear-gradient(160deg, rgba(37,99,235,0.16) 0%, rgba(9,13,28,0.92) 82%),
      radial-gradient(circle at 18% 18%, rgba(147,197,253,0.18) 0%, transparent 42%);
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,0.06),
      0 14px 34px rgba(2,8,23,0.28);
  }

  .cap-media-image {
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover;
    object-position: center;
    opacity: 0.9;
    filter: saturate(0.84) brightness(0.78) contrast(1.04);
    transform: scale(1.01);
    transition: transform 0.45s ease, opacity 0.45s ease, filter 0.45s ease;
  }

  .cap-media-overlay {
    position: absolute;
    inset: 0;
    background:
      linear-gradient(180deg, rgba(7,9,15,0.04) 0%, rgba(7,9,15,0.14) 38%, rgba(7,9,15,0.56) 100%),
      radial-gradient(circle at 78% 18%, rgba(147,197,253,0.14) 0%, transparent 28%);
    pointer-events: none;
  }

  .cap-card:hover .cap-media-image {
    transform: scale(1.035);
    opacity: 0.96;
    filter: saturate(0.9) brightness(0.84) contrast(1.05);
  }

  .cap-card-0, .cap-card-1, .cap-card-2,
  .cap-card-3, .cap-card-4, .cap-card-5 {
    perspective: 800px;
  }


  /* ------------------------------------------------
     HERO PHOTO ORBIT RINGS (keep if already present)
  ------------------------------------------------ */

  /* --- ORBITAL RING SPINS -------------------- */
  
  

  /* --- DOT ORBITS ---------------------------- */

  /* Dot 1 ï¿½ 170px radius */
  

  /* Dot 2 ï¿½ 140px radius */
  

  /* Dot 3 ï¿½ 110px radius */
  

  /* ------------------------------------------------
     HERO CENTERED ï¿½ NEW STYLES
  ------------------------------------------------ */

  /* Scroll indicator pulse */
  @keyframes scrollPulse {
    0%, 100% { opacity: 0.3; transform: scaleY(0.8); }
    50%       { opacity: 1;   transform: scaleY(1); }
  }

  /* Name glow breathing */
  .hero-name {
    animation: nameBreath 6s ease-in-out infinite;
  }

  @keyframes nameBreath {
    0%, 100% {
      text-shadow:
        0 0 30px rgba(147,197,253,0.20),
        0 0 60px rgba(37,99,235,0.12);
    }
    50% {
      text-shadow:
        0 0 40px rgba(147,197,253,0.35),
        0 0 80px rgba(37,99,235,0.20),
        0 0 120px rgba(37,99,235,0.08);
    }
  }

  /* Pulse animation for status dots */
  @keyframes pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 6px rgba(147,197,253,0.8); }
    50%      { opacity: 0.6; box-shadow: 0 0 12px rgba(147,197,253,0.4); }
  }

  /* Mobile adjustments */
  @media (max-width: 640px) {
    .hero-name {
      letter-spacing: 0.03em !important;
    }
  }

  /* ------------------------------------------------ 
     HERO VIEWPORT FIT ï¿½ MOBILE OVERRIDES
  ------------------------------------------------ */

  /* Hide summary and CTAs on mobile to keep headline visible */
  @media (max-width: 639px) {
    /* Summary stays ï¿½ just tighter */
    .hero-summary { margin-top: 8px; }

    /* CTA pill smaller on mobile */
    .hero-cta-pill {
      transform: scale(0.9);
      transform-origin: center;
    }

    /* Social proof hidden on mobile to save space */
    .hero-social-proof { display: none; }
  }

  /* Ensure scroll indicator doesn't overlap content */
  @media (max-height: 700px) {
    .hero-scroll-indicator { display: none; }
  }


  /* ------------------------------------------------
     FEATURED WORK ? SCROLL ANIMATIONS
  ------------------------------------------------ */

  /* WORK SECTION -- IN + OUT ANIMATIONS */

  .work-left        { opacity: 0; transform: translateX(-80px) rotateY(15deg); filter: blur(3px); }
  .work-card-1      { opacity: 0; transform: translateX(70px) translateY(30px) rotateX(12deg); filter: blur(2px); }
  .work-card-2      { opacity: 0; transform: translateX(70px) translateY(40px) rotateY(-18deg); filter: blur(3px); }
  .work-card-3      { opacity: 0; transform: translateY(80px) rotateX(-15deg) scale(0.93); filter: blur(2px); }
  .work-card-center { opacity: 0; transform: translateY(60px) scale(0.88) rotate(-2deg); filter: blur(4px); }
  .work-card-4      { opacity: 0; transform: translateY(-70px) rotateX(20deg) scale(0.92); filter: blur(3px); }

  .work-left.work-in {
    opacity: 1;
    transform: translateX(0) rotateY(0deg);
    filter: blur(0);
    transition:
      opacity 1.6s cubic-bezier(0.22,1,0.36,1),
      transform 1.6s cubic-bezier(0.22,1,0.36,1),
      filter 1.2s ease;
  }

  .work-card-1.work-in {
    opacity: 1;
    transform: translateX(0) translateY(0) rotateX(0deg);
    filter: blur(0);
    transition:
      opacity 1.4s cubic-bezier(0.22,1,0.36,1) 0.15s,
      transform 1.4s cubic-bezier(0.34,1.3,0.64,1) 0.15s,
      filter 1.0s ease 0.15s;
  }

  .work-card-2.work-in {
    opacity: 1;
    transform: translateX(0) translateY(0) rotateY(0deg);
    filter: blur(0);
    transition:
      opacity 1.4s cubic-bezier(0.22,1,0.36,1) 0.28s,
      transform 1.4s cubic-bezier(0.22,1,0.36,1) 0.28s,
      filter 1.0s ease 0.28s;
  }

  .work-card-3.work-in {
    opacity: 1;
    transform: translateY(0) rotateX(0deg) scale(1);
    filter: blur(0);
    transition:
      opacity 1.5s cubic-bezier(0.22,1,0.36,1) 0.18s,
      transform 1.5s cubic-bezier(0.34,1.4,0.64,1) 0.18s,
      filter 1.1s ease 0.18s;
  }

  .work-card-center.work-in {
    opacity: 1;
    transform: translateY(0) scale(1) rotate(0deg);
    filter: blur(0);
    transition:
      opacity 1.6s cubic-bezier(0.22,1,0.36,1) 0.08s,
      transform 1.6s cubic-bezier(0.34,1.25,0.64,1) 0.08s,
      filter 1.2s ease 0.08s;
  }

  .work-card-4.work-in {
    opacity: 1;
    transform: translateY(0) rotateX(0deg) scale(1);
    filter: blur(0);
    transition:
      opacity 1.4s cubic-bezier(0.22,1,0.36,1) 0.35s,
      transform 1.4s cubic-bezier(0.34,1.3,0.64,1) 0.35s,
      filter 1.0s ease 0.35s;
  }

  .work-left.work-out {
    opacity: 0;
    transform: translateX(-60px) rotateY(10deg);
    filter: blur(2px);
    transition:
      opacity 1.0s ease,
      transform 1.0s ease,
      filter 0.75s ease;
  }

  .work-card-1.work-out {
    opacity: 0;
    transform: translateX(50px) translateY(-25px) rotateX(8deg);
    filter: blur(2px);
    transition:
      opacity 0.90s ease 0.06s,
      transform 0.90s ease 0.06s,
      filter 0.70s ease 0.06s;
  }

  .work-card-2.work-out {
    opacity: 0;
    transform: translateX(50px) rotateY(-12deg);
    filter: blur(2px);
    transition:
      opacity 0.90s ease 0.10s,
      transform 0.90s ease 0.10s,
      filter 0.70s ease 0.10s;
  }

  .work-card-3.work-out {
    opacity: 0;
    transform: translateY(50px) rotateX(-10deg) scale(0.95);
    filter: blur(2px);
    transition:
      opacity 0.90s ease 0.04s,
      transform 0.90s ease 0.04s,
      filter 0.70s ease 0.04s;
  }

  .work-card-center.work-out {
    opacity: 0;
    transform: translateY(40px) scale(0.92) rotate(1deg);
    filter: blur(3px);
    transition:
      opacity 1.0s ease,
      transform 1.0s ease,
      filter 0.75s ease;
  }

  .work-card-4.work-out {
    opacity: 0;
    transform: translateY(-50px) rotateX(14deg) scale(0.94);
    filter: blur(2px);
    transition:
      opacity 0.90s ease 0.10s,
      transform 0.90s ease 0.10s,
      filter 0.70s ease 0.10s;
  }

  /* Card hover glow */
  .work-card-1:hover,
  .work-card-2:hover,
  .work-card-3:hover,
  .work-card-4:hover {
    border-color: rgba(147,197,253,0.25) !important;
    box-shadow: 0 0 0 1px rgba(147,197,253,0.10), 0 20px 50px rgba(0,0,0,0.4);
  }

  /* -- PERFORMANCE: GPU layers for all animated elements -- */

  .metric-card,
  .cap-card,
  .work-left,
  .work-card-1,
  .work-card-2,
  .work-card-3,
  .work-card-center,
  .work-card-4 {
    will-change: transform, opacity, filter;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }

  section {
    contain: layout style;
  }

  .hero-section {
    contain: layout style paint;
    isolation: isolate;
  }

  .testi-track,
  .ticker-row {
    will-change: transform;
    contain: layout style;
  }

  .hero-portrait-layer img {
    will-change: transform, filter;
  }

  #cta-graph-canvas,
  #star-canvas {
    will-change: transform;
  }

  .work-card-center {
    animation: centerCardPulse 5s ease-in-out infinite;
  }

  @keyframes centerCardPulse {
    0%, 100% { box-shadow: 0 0 0 1px rgba(255,255,255,0.12), 0 20px 60px rgba(0,0,0,0.4); }
    50%      { box-shadow: 0 0 0 1px rgba(147,197,253,0.22), 0 20px 60px rgba(37,99,235,0.15); }
  }
  .orbit-dot {
    will-change: transform;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform-style: preserve-3d;
  }
  .orbit-ring {
    will-change: transform;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform-style: preserve-3d;
  }
@keyframes orbitSpin1 {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
@keyframes orbitSpin2 {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
@keyframes dot1Orbit {
  from { transform: rotate(0deg) translateX(210px) rotate(0deg) translateZ(0); }
  to   { transform: rotate(360deg) translateX(210px) rotate(-360deg) translateZ(0); }
}
@keyframes dot2Orbit {
  from { transform: rotate(0deg) translateX(151px) rotate(0deg) translateZ(0); }
  to   { transform: rotate(360deg) translateX(151px) rotate(-360deg) translateZ(0); }
}
@keyframes dot3Orbit {
  from { transform: rotate(0deg) translateX(92px) rotate(0deg) translateZ(0); }
  to   { transform: rotate(360deg) translateX(92px) rotate(-360deg) translateZ(0); }
}

  /* -- TESTIMONIAL MARQUEE -- */
  .testi-track {
    animation: testiScroll 55s linear infinite;
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }
  .testi-track:hover {
    animation-play-state: paused;
  }
  @keyframes testiScroll {
    0%   { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .testi-card {
    flex-shrink: 0;
    width: 360px;
    border-radius: 1.25rem;
    padding: 2rem;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.10);
    backdrop-filter: blur(20px);
    transition: border-color 0.25s ease, box-shadow 0.25s ease, transform 0.25s ease;
    cursor: default;
  }
  .testi-card:hover {
    border-color: rgba(147,197,253,0.25);
    box-shadow: 0 0 0 1px rgba(147,197,253,0.10), 0 20px 50px rgba(0,0,0,0.4);
    transform: translateY(-4px);
  }
  .testi-card.testi-new {
    border-color: rgba(37,99,235,0.45);
    box-shadow: 0 0 0 1px rgba(37,99,235,0.20), 0 0 30px rgba(37,99,235,0.15);
    animation: newCardPop 0.6s cubic-bezier(0.34,1.5,0.64,1) forwards;
  }
  @keyframes newCardPop {
    from { opacity: 0; transform: scale(0.85) translateY(20px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }
  #testi-modal[style*="flex"] { display: flex !important; }
  #testi-name:focus, #testi-role:focus, #testi-quote:focus {
    border-color: rgba(147,197,253,0.40) !important;
    outline: none;
  }
  #testi-open-btn:hover {
    background: rgba(37,99,235,0.30) !important;
    border-color: rgba(37,99,235,0.60) !important;
  }

  /* ── TESTIMONIALS 3-ROW ── */
  .testi-row-wrap {
    overflow: hidden;
    width: 100%;
  }
  .testi-row {
    will-change: transform;
    backface-visibility: hidden;
  }
  .testi-card-v2 {
    flex-shrink: 0;
    width: 300px;
    border-radius: 1rem;
    padding: 1.4rem 1.6rem;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.09);
    backdrop-filter: blur(20px);
    transition: border-color 0.25s ease, box-shadow 0.25s ease, transform 0.25s ease;
    cursor: default;
    position: relative;
  }
  .testi-card-v2:hover {
    border-color: rgba(147,197,253,0.25);
    box-shadow: 0 0 0 1px rgba(147,197,253,0.10), 0 16px 40px rgba(0,0,0,0.4);
    transform: translateY(-3px);
  }
  .testi-card-v2.testi-new-v2 {
    border-color: rgba(37,99,235,0.5);
    box-shadow: 0 0 0 1px rgba(37,99,235,0.25), 0 0 28px rgba(37,99,235,0.15);
    animation: newCardPopV2 0.6s cubic-bezier(0.34,1.5,0.64,1) forwards;
  }
  @keyframes newCardPopV2 {
    from { opacity:0; transform:scale(0.85) translateY(18px); }
    to   { opacity:1; transform:scale(1) translateY(0); }
  }
  #testi-modal.testi-open {
    display: flex !important;
  }
  #testi-photo-input + label:hover,
  label[for="testi-photo-input"]:hover {
    background: rgba(255,255,255,0.10) !important;
    color: #cbd5e1 !important;
  }

  /* ── CAPABILITIES BENTO GRID ── */
  .cap-bento-grid {
    display: grid;
    gap: 16px;
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-rows: auto auto auto;
    grid-template-areas:
      "c0  c1  c2"
      "c0  c4  c2"
      "c3  c4  c5";
  }

  /* Card 0 (Growth & Performance) — tall left, spans 2 rows */
  .cap-bento-grid [style*="grid-area: c0"] {
    min-height: 320px;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }

  /* Card 1 (Tracking & Analytics) — top middle, normal */
  .cap-bento-grid [style*="grid-area: c1"] {
    min-height: 180px;
  }

  /* Card 2 (Web Systems) — tall right, spans 2 rows */
  .cap-bento-grid [style*="grid-area: c2"] {
    min-height: 320px;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }

  /* Card 3 (Content & Creative) — bottom left, compact */
  .cap-bento-grid [style*="grid-area: c3"] {
    min-height: 160px;
  }

  /* Card 4 (Digital Operations) — center tall, spans 2 rows */
  .cap-bento-grid [style*="grid-area: c4"] {
    min-height: 320px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }

  /* Card 5 (Web App & Plugin Dev) — bottom right, compact */
  .cap-bento-grid [style*="grid-area: c5"] {
    min-height: 160px;
  }

  /* Mobile: stack all cards single column */
  @media (max-width: 767px) {
    .cap-bento-grid {
      grid-template-columns: 1fr;
      grid-template-rows: unset;
      grid-template-areas:
        "c0"
        "c1"
        "c2"
        "c3"
        "c4"
        "c5";
    }
    .cap-bento-grid [style*="grid-area: c0"],
    .cap-bento-grid [style*="grid-area: c2"],
    .cap-bento-grid [style*="grid-area: c4"] {
      min-height: 220px;
    }

    .cap-media-frame {
      min-height: 118px;
    }
  }

  /* ── LAYOUT CONTAINMENT — limits browser repaint scope ── */

  /* Each section is an isolated paint context */
  /* Browser only repaints the section that changed */
  section {
    contain: layout style;
  }

  /* Card grids: isolated layout — child changes don't bubble up */
  .cap-bento-grid,
  .glass-panel-ultra {
    contain: layout style;
  }

  /* Metric cards grid */
  .grid-cols-2,
  .grid-cols-4 {
    contain: layout;
  }

  /* ── PREVENT SCROLL JANK ── */
  /* Touch scroll acceleration */
  html, body {
    -webkit-overflow-scrolling: touch;
    overflow-x: hidden;
  }

  /* Prevent paint spill during transform animations without blocking interaction */
  .cap-card.cap-in,
  .cap-card.cap-out,
  .metric-card.metric-in,
  .metric-card.metric-out,
  .work-left.work-in,
  .work-left.work-out,
  .work-card-1.work-in, .work-card-1.work-out,
  .work-card-2.work-in, .work-card-2.work-out,
  .work-card-3.work-in, .work-card-3.work-out,
  .work-card-center.work-in, .work-card-center.work-out,
  .work-card-4.work-in, .work-card-4.work-out {
    contain: layout style paint;
  }

  .cap-card.cap-in:not(.animating),
  .metric-card.metric-in:not(.animating),
  .work-left.work-in,
  .work-card-1.work-in,
  .work-card-2.work-in,
  .work-card-3.work-in,
  .work-card-center.work-in,
  .work-card-4.work-in {
    pointer-events: auto;
  }

  /* ── FONT LOADING OPTIMISATION ── */
  @font-face {
    font-display: swap;
  }
</style>






